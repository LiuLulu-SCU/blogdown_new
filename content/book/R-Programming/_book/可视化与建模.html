<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 可视化与建模 | R语言编程</title>
  <meta name="description" content="张敬信老师的R语言学习笔记" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="4 可视化与建模 | R语言编程" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="张敬信老师的R语言学习笔记" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 可视化与建模 | R语言编程" />
  
  <meta name="twitter:description" content="张敬信老师的R语言学习笔记" />
  

<meta name="author" content="刘卢路" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="数据操作.html"/>
<link rel="next" href="markdown.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.4.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.57.1/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.57.1/plotly-latest.min.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX","output/SVG"],
  extensions: ["tex2jax.js","MathMenu.js","MathZoom.js"],
  TeX: {
    extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
  }
});
</script>
<script type="text/javascript"
   src="../../../MathJax/MathJax.js">
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>简介</a></li>
<li class="chapter" data-level="1" data-path="前言.html"><a href="前言.html"><i class="fa fa-check"></i><b>1</b> 前言</a>
<ul>
<li class="chapter" data-level="1.1" data-path="前言.html"><a href="前言.html#section"><i class="fa fa-check"></i><b>1.1</b> </a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="基础语法.html"><a href="基础语法.html"><i class="fa fa-check"></i><b>2</b> 基础语法</a>
<ul>
<li class="chapter" data-level="2.1" data-path="基础语法.html"><a href="基础语法.html#数据结构"><i class="fa fa-check"></i><b>2.1</b> 数据结构</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="基础语法.html"><a href="基础语法.html#向量一维数据"><i class="fa fa-check"></i><b>2.1.1</b> 向量（一维数据）</a></li>
<li class="chapter" data-level="2.1.2" data-path="基础语法.html"><a href="基础语法.html#时间日期"><i class="fa fa-check"></i><b>2.1.2</b> 时间日期</a></li>
<li class="chapter" data-level="2.1.3" data-path="基础语法.html"><a href="基础语法.html#识别日期时间"><i class="fa fa-check"></i><b>2.1.3</b> 识别日期时间</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="基础语法.html"><a href="基础语法.html#控制结构"><i class="fa fa-check"></i><b>2.2</b> 控制结构</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="基础语法.html"><a href="基础语法.html#分支结构"><i class="fa fa-check"></i><b>2.2.1</b> 分支结构</a></li>
<li class="chapter" data-level="2.2.2" data-path="基础语法.html"><a href="基础语法.html#循环结构"><i class="fa fa-check"></i><b>2.2.2</b> 循环结构</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="基础语法.html"><a href="基础语法.html#apply函数组"><i class="fa fa-check"></i><b>2.3</b> apply函数组</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="基础语法.html"><a href="基础语法.html#apply"><i class="fa fa-check"></i><b>2.3.1</b> apply</a></li>
<li class="chapter" data-level="2.3.2" data-path="基础语法.html"><a href="基础语法.html#lapply"><i class="fa fa-check"></i><b>2.3.2</b> lapply</a></li>
<li class="chapter" data-level="2.3.3" data-path="基础语法.html"><a href="基础语法.html#sapply"><i class="fa fa-check"></i><b>2.3.3</b> sapply</a></li>
<li class="chapter" data-level="2.3.4" data-path="基础语法.html"><a href="基础语法.html#vapply"><i class="fa fa-check"></i><b>2.3.4</b> vapply</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="基础语法.html"><a href="基础语法.html#customized-function"><i class="fa fa-check"></i><b>2.4</b> 自定义函数</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="基础语法.html"><a href="基础语法.html#函数设置"><i class="fa fa-check"></i><b>2.4.1</b> 函数设置</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="数据操作.html"><a href="数据操作.html"><i class="fa fa-check"></i><b>3</b> 数据操作</a>
<ul>
<li class="chapter" data-level="3.1" data-path="数据操作.html"><a href="数据操作.html#数据连接"><i class="fa fa-check"></i><b>3.1</b> 数据连接</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="数据操作.html"><a href="数据操作.html#合并行与和并列"><i class="fa fa-check"></i><b>3.1.1</b> 合并行与和并列</a></li>
<li class="chapter" data-level="3.1.2" data-path="数据操作.html"><a href="数据操作.html#根据值匹配合并数据框"><i class="fa fa-check"></i><b>3.1.2</b> 根据值匹配合并数据框</a></li>
<li class="chapter" data-level="3.1.3" data-path="数据操作.html"><a href="数据操作.html#实现r中实现stata的merge命令"><i class="fa fa-check"></i><b>3.1.3</b> 实现R中实现stata的merge命令</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="数据操作.html"><a href="数据操作.html#数据操作-1"><i class="fa fa-check"></i><b>3.2</b> 数据操作</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="数据操作.html"><a href="数据操作.html#选择列select"><i class="fa fa-check"></i><b>3.2.1</b> 选择列（select）</a></li>
<li class="chapter" data-level="3.2.2" data-path="数据操作.html"><a href="数据操作.html#选择列语法"><i class="fa fa-check"></i><b>3.2.2</b> 选择列语法</a></li>
<li class="chapter" data-level="3.2.3" data-path="数据操作.html"><a href="数据操作.html#选择列的例子"><i class="fa fa-check"></i><b>3.2.3</b> 选择列的例子</a></li>
<li class="chapter" data-level="3.2.4" data-path="数据操作.html"><a href="数据操作.html#用--删除列"><i class="fa fa-check"></i><b>3.2.4</b> 用“-” 删除列</a></li>
<li class="chapter" data-level="3.2.5" data-path="数据操作.html"><a href="数据操作.html#调整列的顺序"><i class="fa fa-check"></i><b>3.2.5</b> 调整列的顺序</a></li>
<li class="chapter" data-level="3.2.6" data-path="数据操作.html"><a href="数据操作.html#重命名列"><i class="fa fa-check"></i><b>3.2.6</b> 重命名列</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="数据操作.html"><a href="数据操作.html#分组汇总"><i class="fa fa-check"></i><b>3.3</b> 分组汇总</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="数据操作.html"><a href="数据操作.html#创建分组"><i class="fa fa-check"></i><b>3.3.1</b> 创建分组</a></li>
<li class="chapter" data-level="3.3.2" data-path="数据操作.html"><a href="数据操作.html#分组汇总-1"><i class="fa fa-check"></i><b>3.3.2</b> 分组汇总</a></li>
<li class="chapter" data-level="3.3.3" data-path="数据操作.html"><a href="数据操作.html#自己的例子"><i class="fa fa-check"></i><b>3.3.3</b> 自己的例子</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="数据操作.html"><a href="数据操作.html#其他数据操作"><i class="fa fa-check"></i><b>3.4</b> 其他数据操作</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="数据操作.html"><a href="数据操作.html#按行汇总"><i class="fa fa-check"></i><b>3.4.1</b> 按行汇总</a></li>
<li class="chapter" data-level="3.4.2" data-path="数据操作.html"><a href="数据操作.html#窗口函数"><i class="fa fa-check"></i><b>3.4.2</b> 窗口函数</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="数据操作.html"><a href="数据操作.html#整洁计算"><i class="fa fa-check"></i><b>3.5</b> 整洁计算</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="数据操作.html"><a href="数据操作.html#数据屏蔽与整洁选择"><i class="fa fa-check"></i><b>3.5.1</b> 数据屏蔽与整洁选择</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="可视化与建模.html"><a href="可视化与建模.html"><i class="fa fa-check"></i><b>4</b> 可视化与建模</a>
<ul>
<li class="chapter" data-level="4.1" data-path="可视化与建模.html"><a href="可视化与建模.html#ggplot2基础语法"><i class="fa fa-check"></i><b>4.1</b> ggplot2基础语法</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="可视化与建模.html"><a href="可视化与建模.html#ggplot2概述"><i class="fa fa-check"></i><b>4.1.1</b> ggplot2概述</a></li>
<li class="chapter" data-level="4.1.2" data-path="可视化与建模.html"><a href="可视化与建模.html#数据映射几何对象"><i class="fa fa-check"></i><b>4.1.2</b> 数据、映射、几何对象</a></li>
<li class="chapter" data-level="4.1.3" data-path="可视化与建模.html"><a href="可视化与建模.html#标度"><i class="fa fa-check"></i><b>4.1.3</b> 标度</a></li>
<li class="chapter" data-level="4.1.4" data-path="可视化与建模.html"><a href="可视化与建模.html#统计变换statistics"><i class="fa fa-check"></i><b>4.1.4</b> 统计变换(Statistics)</a></li>
<li class="chapter" data-level="4.1.5" data-path="可视化与建模.html"><a href="可视化与建模.html#坐标系coordinante"><i class="fa fa-check"></i><b>4.1.5</b> 坐标系(Coordinante)</a></li>
<li class="chapter" data-level="4.1.6" data-path="可视化与建模.html"><a href="可视化与建模.html#位置调整position-adjustments"><i class="fa fa-check"></i><b>4.1.6</b> 位置调整(Position adjustments)</a></li>
<li class="chapter" data-level="4.1.7" data-path="可视化与建模.html"><a href="可视化与建模.html#分面facet"><i class="fa fa-check"></i><b>4.1.7</b> 分面(Facet)</a></li>
<li class="chapter" data-level="4.1.8" data-path="可视化与建模.html"><a href="可视化与建模.html#主题theme"><i class="fa fa-check"></i><b>4.1.8</b> 主题(theme)</a></li>
<li class="chapter" data-level="4.1.9" data-path="可视化与建模.html"><a href="可视化与建模.html#输出output"><i class="fa fa-check"></i><b>4.1.9</b> 输出(output)</a></li>
<li class="chapter" data-level="4.1.10" data-path="可视化与建模.html"><a href="可视化与建模.html#export包将ggplot或latice输出为ppt"><i class="fa fa-check"></i><b>4.1.10</b> export包(将ggplot或latice输出为PPT)</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="可视化与建模.html"><a href="可视化与建模.html#自定义ggplot2函数"><i class="fa fa-check"></i><b>4.2</b> 自定义ggplot2函数</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="可视化与建模.html"><a href="可视化与建模.html#为什么要自定义ggplot函数"><i class="fa fa-check"></i><b>4.2.1</b> 为什么要自定义ggplot函数</a></li>
<li class="chapter" data-level="4.2.2" data-path="可视化与建模.html"><a href="可视化与建模.html#单个组件"><i class="fa fa-check"></i><b>4.2.2</b> 单个组件</a></li>
<li class="chapter" data-level="4.2.3" data-path="可视化与建模.html"><a href="可视化与建模.html#多个组件"><i class="fa fa-check"></i><b>4.2.3</b> 多个组件</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="可视化与建模.html"><a href="可视化与建模.html#散点图"><i class="fa fa-check"></i><b>4.3</b> 散点图</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="可视化与建模.html"><a href="可视化与建模.html#密度散点图"><i class="fa fa-check"></i><b>4.3.1</b> 密度散点图</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="可视化与建模.html"><a href="可视化与建模.html#生存分析"><i class="fa fa-check"></i><b>4.4</b> 生存分析</a></li>
<li class="chapter" data-level="4.5" data-path="可视化与建模.html"><a href="可视化与建模.html#plotly"><i class="fa fa-check"></i><b>4.5</b> Plotly</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="可视化与建模.html"><a href="可视化与建模.html#将ggplot对象转化为plotly对象"><i class="fa fa-check"></i><b>4.5.1</b> 将ggplot对象转化为plotly对象</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>I 文档沟通</b></span></li>
<li class="chapter" data-level="5" data-path="markdown.html"><a href="markdown.html"><i class="fa fa-check"></i><b>5</b> Markdown</a>
<ul>
<li class="chapter" data-level="5.1" data-path="markdown.html"><a href="markdown.html#markdown-intro"><i class="fa fa-check"></i><b>5.1</b> 简介</a></li>
<li class="chapter" data-level="5.2" data-path="markdown.html"><a href="markdown.html#行内格式"><i class="fa fa-check"></i><b>5.2</b> 行内格式</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="markdown.html"><a href="markdown.html#强调上下标和行内代码"><i class="fa fa-check"></i><b>5.2.1</b> 强调、上下标和行内代码</a></li>
<li class="chapter" data-level="5.2.2" data-path="markdown.html"><a href="markdown.html#超链接"><i class="fa fa-check"></i><b>5.2.2</b> 超链接</a></li>
<li class="chapter" data-level="5.2.3" data-path="markdown.html"><a href="markdown.html#插入引用citations"><i class="fa fa-check"></i><b>5.2.3</b> 插入引用citations</a></li>
<li class="chapter" data-level="5.2.4" data-path="markdown.html"><a href="markdown.html#换行空格"><i class="fa fa-check"></i><b>5.2.4</b> 换行空格</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="markdown.html"><a href="markdown.html#块级元素"><i class="fa fa-check"></i><b>5.3</b> 块级元素</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="markdown.html"><a href="markdown.html#代码块"><i class="fa fa-check"></i><b>5.3.1</b> 代码块</a></li>
<li class="chapter" data-level="5.3.2" data-path="markdown.html"><a href="markdown.html#标题"><i class="fa fa-check"></i><b>5.3.2</b> 标题</a></li>
<li class="chapter" data-level="5.3.3" data-path="markdown.html"><a href="markdown.html#分割线"><i class="fa fa-check"></i><b>5.3.3</b> 分割线</a></li>
<li class="chapter" data-level="5.3.4" data-path="markdown.html"><a href="markdown.html#块级元素引用段落引用"><i class="fa fa-check"></i><b>5.3.4</b> 块级元素引用（段落引用）</a></li>
<li class="chapter" data-level="5.3.5" data-path="markdown.html"><a href="markdown.html#列表"><i class="fa fa-check"></i><b>5.3.5</b> 列表</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="markdown.html"><a href="markdown.html#行内块元素"><i class="fa fa-check"></i><b>5.4</b> 行内块元素</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="markdown.html"><a href="markdown.html#图片"><i class="fa fa-check"></i><b>5.4.1</b> 图片</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="markdown.html"><a href="markdown.html#数学公式"><i class="fa fa-check"></i><b>5.5</b> 数学公式</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="markdown.html"><a href="markdown.html#markdown如何显示数学公式"><i class="fa fa-check"></i><b>5.5.1</b> Markdown如何显示数学公式</a></li>
<li class="chapter" data-level="5.5.2" data-path="markdown.html"><a href="markdown.html#数学公式的类别"><i class="fa fa-check"></i><b>5.5.2</b> 数学公式的类别</a></li>
<li class="chapter" data-level="5.5.3" data-path="markdown.html"><a href="markdown.html#具体公式"><i class="fa fa-check"></i><b>5.5.3</b> 具体公式</a></li>
<li class="chapter" data-level="5.5.4" data-path="markdown.html"><a href="markdown.html#section-1"><i class="fa fa-check"></i><b>5.5.4</b> </a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="rmarkdown.html"><a href="rmarkdown.html"><i class="fa fa-check"></i><b>6</b> RMarkdown</a>
<ul>
<li class="chapter" data-level="6.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown简介"><i class="fa fa-check"></i><b>6.1</b> RMarkdown简介</a></li>
<li class="chapter" data-level="6.2" data-path="rmarkdown.html"><a href="rmarkdown.html#安装"><i class="fa fa-check"></i><b>6.2</b> 安装</a></li>
<li class="chapter" data-level="6.3" data-path="rmarkdown.html"><a href="rmarkdown.html#基础"><i class="fa fa-check"></i><b>6.3</b> 基础</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="rmarkdown.html"><a href="rmarkdown.html#rmarkdown基础"><i class="fa fa-check"></i><b>6.3.1</b> RMarkdown基础</a></li>
<li class="chapter" data-level="6.3.2" data-path="rmarkdown.html"><a href="rmarkdown.html#compile"><i class="fa fa-check"></i><b>6.3.2</b> 编写R Markdown文档</a></li>
<li class="chapter" data-level="6.3.3" data-path="rmarkdown.html"><a href="rmarkdown.html#备忘清单cheat-sheet"><i class="fa fa-check"></i><b>6.3.3</b> 备忘清单（Cheat sheet）</a></li>
<li class="chapter" data-level="6.3.4" data-path="rmarkdown.html"><a href="rmarkdown.html#输出格式"><i class="fa fa-check"></i><b>6.3.4</b> 输出格式</a></li>
<li class="chapter" data-level="6.3.5" data-path="rmarkdown.html"><a href="rmarkdown.html#r代码块和r行内代码"><i class="fa fa-check"></i><b>6.3.5</b> R代码块和R行内代码</a></li>
<li class="chapter" data-level="6.3.6" data-path="rmarkdown.html"><a href="rmarkdown.html#插入图片"><i class="fa fa-check"></i><b>6.3.6</b> 插入图片</a></li>
<li class="chapter" data-level="6.3.7" data-path="rmarkdown.html"><a href="rmarkdown.html#表格"><i class="fa fa-check"></i><b>6.3.7</b> 表格</a></li>
<li class="chapter" data-level="6.3.8" data-path="rmarkdown.html"><a href="rmarkdown.html#行内代码"><i class="fa fa-check"></i><b>6.3.8</b> 行内代码</a></li>
<li class="chapter" data-level="6.3.9" data-path="rmarkdown.html"><a href="rmarkdown.html#在rmarkdown使用其他语言"><i class="fa fa-check"></i><b>6.3.9</b> 在RMarkdown使用其他语言</a></li>
<li class="chapter" data-level="6.3.10" data-path="rmarkdown.html"><a href="rmarkdown.html#交互式文档"><i class="fa fa-check"></i><b>6.3.10</b> 交互式文档</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="rmarkdown.html"><a href="rmarkdown.html#文档格式htmlpdfword"><i class="fa fa-check"></i><b>6.4</b> 文档格式（HTML,PDF,Word…）</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="rmarkdown.html"><a href="rmarkdown.html#html"><i class="fa fa-check"></i><b>6.4.1</b> HTML</a></li>
<li class="chapter" data-level="6.4.2" data-path="rmarkdown.html"><a href="rmarkdown.html#目录table-of-contents"><i class="fa fa-check"></i><b>6.4.2</b> 目录（Table of contents）</a></li>
<li class="chapter" data-level="6.4.3" data-path="rmarkdown.html"><a href="rmarkdown.html#小节编号section-numbering"><i class="fa fa-check"></i><b>6.4.3</b> 小节编号Section numbering</a></li>
<li class="chapter" data-level="6.4.4" data-path="rmarkdown.html"><a href="rmarkdown.html#tabbed-sections"><i class="fa fa-check"></i><b>6.4.4</b> Tabbed sections</a></li>
<li class="chapter" data-level="6.4.5" data-path="rmarkdown.html"><a href="rmarkdown.html#外观和样式appearance-and-style"><i class="fa fa-check"></i><b>6.4.5</b> 外观和样式（Appearance and style）</a></li>
<li class="chapter" data-level="6.4.6" data-path="rmarkdown.html"><a href="rmarkdown.html#图片选项figure-options"><i class="fa fa-check"></i><b>6.4.6</b> 图片选项（Figure options）</a></li>
<li class="chapter" data-level="6.4.7" data-path="rmarkdown.html"><a href="rmarkdown.html#数据框显示data-frame-printing"><i class="fa fa-check"></i><b>6.4.7</b> 数据框显示（Data frame printing）</a></li>
<li class="chapter" data-level="6.4.8" data-path="rmarkdown.html"><a href="rmarkdown.html#代码折叠code-folding"><i class="fa fa-check"></i><b>6.4.8</b> 代码折叠（Code folding）</a></li>
<li class="chapter" data-level="6.4.9" data-path="rmarkdown.html"><a href="rmarkdown.html#mathjax数学公式的支持"><i class="fa fa-check"></i><b>6.4.9</b> MathJax数学公式的支持</a></li>
<li class="chapter" data-level="6.4.10" data-path="rmarkdown.html"><a href="rmarkdown.html#文档依赖关系document-dependencies"><i class="fa fa-check"></i><b>6.4.10</b> 文档依赖关系（Document dependencies）</a></li>
<li class="chapter" data-level="6.4.11" data-path="rmarkdown.html"><a href="rmarkdown.html#保留md文件"><i class="fa fa-check"></i><b>6.4.11</b> 保留<code>md</code>文件</a></li>
<li class="chapter" data-level="6.4.12" data-path="rmarkdown.html"><a href="rmarkdown.html#includes"><i class="fa fa-check"></i><b>6.4.12</b> Includes</a></li>
<li class="chapter" data-level="6.4.13" data-path="rmarkdown.html"><a href="rmarkdown.html#自定义模板"><i class="fa fa-check"></i><b>6.4.13</b> 自定义模板</a></li>
<li class="chapter" data-level="6.4.14" data-path="rmarkdown.html"><a href="rmarkdown.html#markdown-extensions"><i class="fa fa-check"></i><b>6.4.14</b> Markdown extensions</a></li>
<li class="chapter" data-level="6.4.15" data-path="rmarkdown.html"><a href="rmarkdown.html#pandoc参数"><i class="fa fa-check"></i><b>6.4.15</b> Pandoc参数</a></li>
<li class="chapter" data-level="6.4.16" data-path="rmarkdown.html"><a href="rmarkdown.html#共享选项设置shared-options"><i class="fa fa-check"></i><b>6.4.16</b> 共享选项设置（Shared options）</a></li>
<li class="chapter" data-level="6.4.17" data-path="rmarkdown.html"><a href="rmarkdown.html#html-片段-html-fragments"><i class="fa fa-check"></i><b>6.4.17</b> HTML 片段（ HTML fragments）</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="bookdown.html"><a href="bookdown.html"><i class="fa fa-check"></i><b>7</b> Bookdown</a>
<ul>
<li class="chapter" data-level="7.1" data-path="bookdown.html"><a href="bookdown.html#bookdown-intro"><i class="fa fa-check"></i><b>7.1</b> 简介</a></li>
<li class="chapter" data-level="7.2" data-path="bookdown.html"><a href="bookdown.html#创建图书"><i class="fa fa-check"></i><b>7.2</b> 创建图书</a></li>
<li class="chapter" data-level="7.3" data-path="bookdown.html"><a href="bookdown.html#bookdown-edit"><i class="fa fa-check"></i><b>7.3</b> 编辑图书（Editing）</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="bookdown.html"><a href="bookdown.html#构建图书build-the-book"><i class="fa fa-check"></i><b>7.3.1</b> 构建图书（Build the book）</a></li>
<li class="chapter" data-level="7.3.2" data-path="bookdown.html"><a href="bookdown.html#预览章节preview-a-chapter"><i class="fa fa-check"></i><b>7.3.2</b> 预览章节（Preview a chapter）</a></li>
<li class="chapter" data-level="7.3.3" data-path="bookdown.html"><a href="bookdown.html#serve-the-book"><i class="fa fa-check"></i><b>7.3.3</b> Serve the book</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="bookdown.html"><a href="bookdown.html#项目结构"><i class="fa fa-check"></i><b>7.4</b> 项目结构</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="bookdown.html"><a href="bookdown.html#首页文件index-file"><i class="fa fa-check"></i><b>7.4.1</b> 首页文件（Index file）</a></li>
<li class="chapter" data-level="7.4.2" data-path="bookdown.html"><a href="bookdown.html#rmd文件-rmd-files"><i class="fa fa-check"></i><b>7.4.2</b> Rmd文件（ Rmd files）</a></li>
<li class="chapter" data-level="7.4.3" data-path="bookdown.html"><a href="bookdown.html#bookdown.yml"><i class="fa fa-check"></i><b>7.4.3</b> <code>_bookdown.yml</code></a></li>
<li class="chapter" data-level="7.4.4" data-path="bookdown.html"><a href="bookdown.html#output.yml"><i class="fa fa-check"></i><b>7.4.4</b> <code>_output.yml</code></a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="bookdown.html"><a href="bookdown.html#bookdown-markdown"><i class="fa fa-check"></i><b>7.5</b> Markdown extensions</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="bookdown.html"><a href="bookdown.html#equations"><i class="fa fa-check"></i><b>7.5.1</b> 公式编号</a></li>
<li class="chapter" data-level="7.5.2" data-path="bookdown.html"><a href="bookdown.html#theorems"><i class="fa fa-check"></i><b>7.5.2</b> 定理和证明（Theorems and proofs）</a></li>
<li class="chapter" data-level="7.5.3" data-path="bookdown.html"><a href="bookdown.html#特殊标题special-headers"><i class="fa fa-check"></i><b>7.5.3</b> 特殊标题（Special headers）</a></li>
<li class="chapter" data-level="7.5.4" data-path="bookdown.html"><a href="bookdown.html#文本引用text-references"><i class="fa fa-check"></i><b>7.5.4</b> 文本引用（Text references）</a></li>
<li class="chapter" data-level="7.5.5" data-path="bookdown.html"><a href="bookdown.html#交叉引用"><i class="fa fa-check"></i><b>7.5.5</b> 交叉引用</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="bookdown.html"><a href="bookdown.html#bookdown-output"><i class="fa fa-check"></i><b>7.6</b> 输出格式</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="写轮眼.html"><a href="写轮眼.html"><i class="fa fa-check"></i><b>8</b> 写轮眼</a>
<ul>
<li class="chapter" data-level="8.1" data-path="写轮眼.html"><a href="写轮眼.html#前期配置"><i class="fa fa-check"></i><b>8.1</b> 前期配置</a></li>
<li class="chapter" data-level="8.2" data-path="写轮眼.html"><a href="写轮眼.html#键盘快捷键"><i class="fa fa-check"></i><b>8.2</b> 键盘快捷键</a></li>
<li class="chapter" data-level="8.3" data-path="写轮眼.html"><a href="写轮眼.html#幻灯片格式"><i class="fa fa-check"></i><b>8.3</b> 幻灯片格式</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="写轮眼.html"><a href="写轮眼.html#幻灯片的属性"><i class="fa fa-check"></i><b>8.3.1</b> 幻灯片的属性</a></li>
<li class="chapter" data-level="8.3.2" data-path="写轮眼.html"><a href="写轮眼.html#首页标题幻灯片"><i class="fa fa-check"></i><b>8.3.2</b> 首页标题幻灯片</a></li>
<li class="chapter" data-level="8.3.3" data-path="写轮眼.html"><a href="写轮眼.html#内容类"><i class="fa fa-check"></i><b>8.3.3</b> 内容类</a></li>
<li class="chapter" data-level="8.3.4" data-path="写轮眼.html"><a href="写轮眼.html#出现动画"><i class="fa fa-check"></i><b>8.3.4</b> 出现动画</a></li>
<li class="chapter" data-level="8.3.5" data-path="写轮眼.html"><a href="写轮眼.html#演讲者注释"><i class="fa fa-check"></i><b>8.3.5</b> 演讲者注释</a></li>
<li class="chapter" data-level="8.3.6" data-path="写轮眼.html"><a href="写轮眼.html#yoloyou-only-live-once"><i class="fa fa-check"></i><b>8.3.6</b> yolo(you only live once)</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="写轮眼.html"><a href="写轮眼.html#建立和预览幻灯片"><i class="fa fa-check"></i><b>8.4</b> 建立和预览幻灯片</a></li>
<li class="chapter" data-level="8.5" data-path="写轮眼.html"><a href="写轮眼.html#独立html输出设置"><i class="fa fa-check"></i><b>8.5</b> 独立HTML输出设置</a></li>
<li class="chapter" data-level="8.6" data-path="写轮眼.html"><a href="写轮眼.html#css和主题"><i class="fa fa-check"></i><b>8.6</b> CSS和主题</a></li>
<li class="chapter" data-level="8.7" data-path="写轮眼.html"><a href="写轮眼.html#一些提示和小技巧"><i class="fa fa-check"></i><b>8.7</b> 一些提示和小技巧</a>
<ul>
<li class="chapter" data-level="8.7.1" data-path="写轮眼.html"><a href="写轮眼.html#自动放映"><i class="fa fa-check"></i><b>8.7.1</b> 自动放映</a></li>
<li class="chapter" data-level="8.7.2" data-path="写轮眼.html"><a href="写轮眼.html#倒计时计时器"><i class="fa fa-check"></i><b>8.7.2</b> 倒计时计时器</a></li>
<li class="chapter" data-level="8.7.3" data-path="写轮眼.html"><a href="写轮眼.html#高亮代码行"><i class="fa fa-check"></i><b>8.7.3</b> 高亮代码行</a></li>
<li class="chapter" data-level="8.7.4" data-path="写轮眼.html"><a href="写轮眼.html#离线模式"><i class="fa fa-check"></i><b>8.7.4</b> 离线模式</a></li>
<li class="chapter" data-level="8.7.5" data-path="写轮眼.html"><a href="写轮眼.html#宏指令macros"><i class="fa fa-check"></i><b>8.7.5</b> 宏指令Macros</a></li>
<li class="chapter" data-level="8.7.6" data-path="写轮眼.html"><a href="写轮眼.html#打印pdf"><i class="fa fa-check"></i><b>8.7.6</b> 打印PDF</a></li>
</ul></li>
<li class="chapter" data-level="8.8" data-path="写轮眼.html"><a href="写轮眼.html#总结术语"><i class="fa fa-check"></i><b>8.8</b> 总结术语</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="数据集介绍.html"><a href="数据集介绍.html"><i class="fa fa-check"></i><b>9</b> 数据集介绍</a>
<ul>
<li class="chapter" data-level="9.1" data-path="数据集介绍.html"><a href="数据集介绍.html#mpg数据集"><i class="fa fa-check"></i><b>9.1</b> mpg数据集</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="附录.html"><a href="附录.html"><i class="fa fa-check"></i><b>10</b> 附录</a>
<ul>
<li class="chapter" data-level="10.1" data-path="附录.html"><a href="附录.html#颜色"><i class="fa fa-check"></i><b>10.1</b> 颜色</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="附录-1.html"><a href="附录-1.html"><i class="fa fa-check"></i><b>11</b> 附录</a>
<ul>
<li class="chapter" data-level="11.1" data-path="附录-1.html"><a href="附录-1.html#颜色-1"><i class="fa fa-check"></i><b>11.1</b> 颜色</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="正则表达式.html"><a href="正则表达式.html"><i class="fa fa-check"></i><b>12</b> 正则表达式</a>
<ul>
<li class="chapter" data-level="12.1" data-path="正则表达式.html"><a href="正则表达式.html#grep函数"><i class="fa fa-check"></i><b>12.1</b> grep函数</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="正则表达式.html"><a href="正则表达式.html#函数参数"><i class="fa fa-check"></i><b>12.1.1</b> 函数参数</a></li>
<li class="chapter" data-level="12.1.2" data-path="正则表达式.html"><a href="正则表达式.html#模式pattern与匹配match"><i class="fa fa-check"></i><b>12.1.2</b> 模式（pattern）与匹配（match）</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="正则表达式.html"><a href="正则表达式.html#元字符"><i class="fa fa-check"></i><b>12.2</b> 元字符</a></li>
<li class="chapter" data-level="12.3" data-path="正则表达式.html"><a href="正则表达式.html#常用文本处理函数"><i class="fa fa-check"></i><b>12.3</b> 常用文本处理函数</a></li>
<li class="chapter" data-level="12.4" data-path="正则表达式.html"><a href="正则表达式.html#案例"><i class="fa fa-check"></i><b>12.4</b> 案例</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="正则表达式.html"><a href="正则表达式.html#查找指定目录下的jpg图像文件list.files函数"><i class="fa fa-check"></i><b>12.4.1</b> 查找指定目录下的jpg图像文件（list.files函数）</a></li>
<li class="chapter" data-level="12.4.2" data-path="正则表达式.html"><a href="正则表达式.html#全宋词"><i class="fa fa-check"></i><b>12.4.2</b> 全宋词</a></li>
<li class="chapter" data-level="12.4.3" data-path="正则表达式.html"><a href="正则表达式.html#sci筛选行"><i class="fa fa-check"></i><b>12.4.3</b> SCI（筛选行）</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R语言编程</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="可视化与建模" class="section level1" number="4">
<h1><span class="header-section-number">4</span> 可视化与建模</h1>
<div id="ggplot2基础语法" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> ggplot2基础语法</h2>
<div id="ggplot2概述" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> ggplot2概述</h3>
<p>ggplot是最流行的R可视化包，基于图层化语图形是一层一层的图层叠加而成，先进的绘图理念、优雅的语法代码、美观大方的生成图形，让ggplot2 迅速走红。</p>
<p><strong>ggplot2 绘图语法</strong></p>
<p>选取<strong>整洁数据</strong>将其<strong>映射</strong>为<strong>几何对象</strong>(如点、线等)，几何对象具有美学特征(如坐标轴、颜色等) ，若需要则对数据做<strong>统计变换</strong>，<strong>调整标度</strong>，将结果投影到<strong>坐标系</strong>，再根据喜好选择<strong>主题</strong>。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-1"></span>
<img src="fig/4/04-01-01.jpg" alt="ggplot2 绘图流程" width="3585" />
<p class="caption">
图4.1: ggplot2 绘图流程
</p>
</div>
<p>ggplot 的语法包括10 个部件：</p>
<ul>
<li>数据（data）</li>
<li>映射（mapping）</li>
<li>几何对象（grom）</li>
<li>标度（scale）</li>
<li>统计变换（stats）</li>
<li>坐标系（coord）</li>
<li>位置调整（position adjustments）</li>
<li>分面（facet）</li>
<li>主题（theme）</li>
<li>输出（output）</li>
</ul>
<p>10 个部件中，前3 个是必须的，其他部件ggplot2 会自动帮你做好它认为’’ 最优’’ 的配置，当然也都可以手动定制。</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="可视化与建模.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="sc">&lt;</span>DATA<span class="sc">&gt;</span>,</span>
<span id="cb139-2"><a href="可视化与建模.html#cb139-2" aria-hidden="true" tabindex="-1"></a>       <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="sc">&lt;</span>MAPPINGS<span class="sc">&gt;</span>)) <span class="sc">+</span></span>
<span id="cb139-3"><a href="可视化与建模.html#cb139-3" aria-hidden="true" tabindex="-1"></a>       <span class="er">&lt;</span>GEOM_FUNCTION<span class="sc">&gt;</span>(</span>
<span id="cb139-4"><a href="可视化与建模.html#cb139-4" aria-hidden="true" tabindex="-1"></a>                  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="sc">&lt;</span>MAPPINGS<span class="sc">&gt;</span>),</span>
<span id="cb139-5"><a href="可视化与建模.html#cb139-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">stat =</span> <span class="sc">&lt;</span>STAT<span class="sc">&gt;</span>,</span>
<span id="cb139-6"><a href="可视化与建模.html#cb139-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position =</span> <span class="sc">&lt;</span>POSITION<span class="sc">&gt;</span>) <span class="sc">+</span></span>
<span id="cb139-7"><a href="可视化与建模.html#cb139-7" aria-hidden="true" tabindex="-1"></a>       <span class="er">&lt;</span>SCALE_FUNCTION<span class="sc">&gt;</span> <span class="sc">+</span></span>
<span id="cb139-8"><a href="可视化与建模.html#cb139-8" aria-hidden="true" tabindex="-1"></a>       <span class="er">&lt;</span>COORDINATE_FUNCTION<span class="sc">&gt;</span> <span class="sc">+</span></span>
<span id="cb139-9"><a href="可视化与建模.html#cb139-9" aria-hidden="true" tabindex="-1"></a>       <span class="er">&lt;</span>FACET_FUNCTION<span class="sc">&gt;</span> <span class="sc">+</span></span>
<span id="cb139-10"><a href="可视化与建模.html#cb139-10" aria-hidden="true" tabindex="-1"></a>       <span class="er">&lt;</span>THEME_FUNCTION<span class="sc">&gt;</span></span></code></pre></div>
</div>
<div id="数据映射几何对象" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> 数据、映射、几何对象</h3>
<p><strong>数据(data)</strong></p>
<p>数据：用于绘图的数据，需要是整洁的数据框。本节用ggplot2 自带数据集演示。</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="可视化与建模.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb140-2"><a href="可视化与建模.html#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mpg, <span class="dv">4</span>)</span></code></pre></div>
<pre><code>## # A tibble: 4 x 11
##   manufacturer model displ  year   cyl trans      drv     cty   hwy fl    class 
##   &lt;chr&gt;        &lt;chr&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;      &lt;chr&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt; &lt;chr&gt; 
## 1 audi         a4      1.8  1999     4 auto(l5)   f        18    29 p     compa~
## 2 audi         a4      1.8  1999     4 manual(m5) f        21    29 p     compa~
## 3 audi         a4      2    2008     4 manual(m6) f        20    31 p     compa~
## 4 audi         a4      2    2008     4 auto(av)   f        21    30 p     compa~</code></pre>
<p>用ggplot() 创建一个坐标系统，先只提供数据，此时只是创建了一个空的图形：</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="可视化与建模.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg)</span></code></pre></div>
<p><strong>映射(mapping)</strong></p>
<p>函数aes() 是ggplot2 中的映射函数, 所谓<strong>映射就是将数据集中的变量数据映射(关联) 到相应的图形属性</strong>，也称为“美学映射”或“美学”。</p>
<p>最常用的映射(美学) 有：</p>
<ul>
<li>x：x轴</li>
<li>y：y轴</li>
<li>color：颜色</li>
<li>fill：填充</li>
<li>size：大小</li>
<li>shape：形状</li>
<li>alpha：透明度</li>
</ul>
<p>最需要的美学是x 和y, 分别映射到变量displ 和hwy, 再将美学color 映射到drv，此时图形就有
了坐标轴和网格线，color 美学在绘制几何对象前还体现不出来：</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="可视化与建模.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ,<span class="at">y =</span> hwy,<span class="at">color =</span> drv))</span></code></pre></div>
<p>注意：映射不是直接为出现在图形中的颜色、外形、线型等设定特定值，而是建立数据中的变量
与可见的图形元素之间的联系，经常将图形的美学color, size 等映射到数据集的分类变量，以实现
不同分组用不同的美学来区分。所以，若要为美学指定特定值，比如color = “red”, 是不能放在映射aes() 中的。</p>
<p><strong>几何对象(Geometric)</strong></p>
<p>每个图形都是采用不同的视觉对象来表达数据，称为是‘‘几何对象’’。
通常用不同类型的“几何对象” 从不同角度来表达数据，如散点图、平滑曲线、线形图、条形图、
箱线图等。
ggplot2 提供了50 余种“几何对象”，均以geom_xxxx() 的方式命名，常用的有：</p>
<ul>
<li>geom_point()：散点图</li>
<li>geom_line()：折线图</li>
<li>geom_smooth()：光滑（拟合）曲线</li>
<li>geom_bar()/geom_col()：条形图</li>
<li>geom_histogram()：直方图</li>
<li>geom_density()：概率密度图</li>
<li>geom_boxplot()：箱线图</li>
<li>geom_abline()：参考直线</li>
</ul>
<p>要绘制几何对象，就是添加图层即可。</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="可视化与建模.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ,<span class="at">y =</span> hwy,<span class="at">color =</span> drv))<span class="sc">+</span></span>
<span id="cb144-2"><a href="可视化与建模.html#cb144-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>不同的几何对象支持的美学会有些不同，美学映射也可以放在几何对象中，上面代码可改写为：</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="可视化与建模.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ,<span class="at">y =</span> hwy))<span class="sc">+</span></span>
<span id="cb145-2"><a href="可视化与建模.html#cb145-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span> drv))</span></code></pre></div>
<p>前面提到，为图形美学设置特定值也是可以的，但不能放在映射aes() 中：</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="可视化与建模.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mpg,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> displ,<span class="at">y =</span> hwy))<span class="sc">+</span></span>
<span id="cb146-2"><a href="可视化与建模.html#cb146-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color=</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>图层是可以依次叠加的，再添加一个几何对象：光滑曲线，然后来区分一下如下两个图形：</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="可视化与建模.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy,<span class="at">color=</span>drv))<span class="sc">+</span></span>
<span id="cb147-2"><a href="可视化与建模.html#cb147-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb147-3"><a href="可视化与建模.html#cb147-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="可视化与建模.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy))<span class="sc">+</span></span>
<span id="cb149-2"><a href="可视化与建模.html#cb149-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>drv))<span class="sc">+</span></span>
<span id="cb149-3"><a href="可视化与建模.html#cb149-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>为什么会出现这种不同呢？这就涉及ggplot2“全局”与“局部”的约定：</p>
<ul>
<li>ggplot() 中的数据和映射，是全局的，可供所有几何对象共用；</li>
<li>而位于“几何对象”中的数据和映射，是局部的，只供该几何对象使用；</li>
<li>“几何对象”优先使用局部的，局部没有则用全局的。</li>
</ul>
</div>
<div id="标度" class="section level3" number="4.1.3">
<h3><span class="header-section-number">4.1.3</span> 标度</h3>
<p>通常ggplot2 会自动根据输入变量选择最优的坐标刻度方案，若要手动设置或调整，就需要用到标度函数：scale_<MAPPING>_<KIND>().</p>
<p>标度函数控制几何对象中的标度映射：不只是x, y 轴，还有color, fill, shape, size 产生的图例。它们是数据中的连续或分类变量的可视化表示，这需要关联到标度，所以要用到映射。</p>
<p>常用的标度函数有：</p>
<ul>
<li>scale_*_continunos()：*为x或y</li>
<li>scale_*_discrete()：*为x或y</li>
<li>scale_x_date()</li>
<li>scale_x_datetime()</li>
<li>scale_<em><em>log10()，scale</em></em>_sqrt(),scale_*_reverse()：*为x或y</li>
<li>scalse_<em><em>gradient()，scale</em></em>_gradient2()，*为color，fill等</li>
</ul>
<p>scales 包提供了很多现成的设置刻度标签风格的函数。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-11"></span>
<img src="fig/4/04-02-01.jpg" alt="图例与坐标轴的组件" width="390" />
<p class="caption">
图4.2: 图例与坐标轴的组件
</p>
</div>
<div id="修改坐标轴刻度及刻度标签" class="section level4" number="4.1.3.1">
<h4><span class="header-section-number">4.1.3.1</span> 修改坐标轴刻度及刻度标签</h4>
<p>用scale_*_continuous() 修改连续变量坐标轴的刻度和标签：</p>
<ul>
<li>参数breaks 设置各个刻度的位置</li>
<li>参数labels 设置各个刻度对应的标签</li>
</ul>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="可视化与建模.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy))<span class="sc">+</span></span>
<span id="cb151-2"><a href="可视化与建模.html#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb151-3"><a href="可视化与建模.html#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">15</span>,<span class="dv">40</span>,<span class="at">by=</span><span class="dv">10</span>),</span>
<span id="cb151-4"><a href="可视化与建模.html#cb151-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;一五&quot;</span>,<span class="st">&quot;二五&quot;</span>,<span class="st">&quot;三五&quot;</span>))</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
<p>用scale_*_discrete() 修改离散变量坐标轴的标签：</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="可视化与建模.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(<span class="at">x =</span> drv))<span class="sc">+</span></span>
<span id="cb152-2"><a href="可视化与建模.html#cb152-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span>   <span class="co">#条形图</span></span>
<span id="cb152-3"><a href="可视化与建模.html#cb152-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;4&quot;</span><span class="ot">=</span><span class="st">&quot;四驱&quot;</span>,<span class="st">&quot;f&quot;</span><span class="ot">=</span><span class="st">&quot;前驱&quot;</span>,<span class="st">&quot;r&quot;</span><span class="ot">=</span><span class="st">&quot;后驱&quot;</span>))</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>用scale_x_date() 设置日期刻度，参数date_breaks 设置刻度间隔，date_labels 设置标签的日期格式；借助scales包中的函数设置特殊格式，比如百分数(percent)、科学计数法(scientific)、美元格式(dollar) 等。</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="可视化与建模.html#cb153-1" aria-hidden="true" tabindex="-1"></a>economics</span></code></pre></div>
<pre><code>## # A tibble: 574 x 6
##    date         pce    pop psavert uempmed unemploy
##    &lt;date&gt;     &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;
##  1 1967-07-01  507. 198712    12.6     4.5     2944
##  2 1967-08-01  510. 198911    12.6     4.7     2945
##  3 1967-09-01  516. 199113    11.9     4.6     2958
##  4 1967-10-01  512. 199311    12.9     4.9     3143
##  5 1967-11-01  517. 199498    12.8     4.7     3066
##  6 1967-12-01  525. 199657    11.8     4.8     3018
##  7 1968-01-01  531. 199808    11.7     5.1     2878
##  8 1968-02-01  534. 199920    12.3     4.5     3001
##  9 1968-03-01  544. 200056    11.7     4.1     2877
## 10 1968-04-01  544  200208    12.3     4.6     2709
## # ... with 564 more rows</code></pre>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="可视化与建模.html#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">tail</span>(economics,<span class="dv">45</span>),<span class="fu">aes</span>(date,uempmed<span class="sc">/</span><span class="dv">100</span>))<span class="sc">+</span></span>
<span id="cb155-2"><a href="可视化与建模.html#cb155-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb155-3"><a href="可视化与建模.html#cb155-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">&quot;6 months&quot;</span>,<span class="at">date_labels =</span> <span class="st">&quot;%b%Y&quot;</span>)<span class="sc">+</span></span>
<span id="cb155-4"><a href="可视化与建模.html#cb155-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="修改坐标轴标签图例名及图例位置" class="section level4" number="4.1.3.2">
<h4><span class="header-section-number">4.1.3.2</span> 修改坐标轴标签、图例名及图例位置</h4>
<p>用labs() 函数的参数x, y, 或者函数xlab(), ylab(), 设置x 轴、y 轴标签，前面已使用color美学，则可以在labs() 函数中使用参数color 修改颜色的图例名。</p>
<p>图例位置是在theme 图层通过参数legend.position 设置，可选取值有“none”，“left”，“right”，
“bottom”， “top”。</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="可视化与建模.html#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy))<span class="sc">+</span></span>
<span id="cb156-2"><a href="可视化与建模.html#cb156-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>drv))<span class="sc">+</span></span>
<span id="cb156-3"><a href="可视化与建模.html#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;引擎大小（L）&quot;</span>,<span class="at">y=</span><span class="st">&quot;高速燃油率（mpg）&quot;</span>,<span class="at">color=</span><span class="st">&quot;驱动类型&quot;</span>) <span class="sc">+</span></span>
<span id="cb156-4"><a href="可视化与建模.html#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#xlab(&quot;引擎大小（L）&quot;)+ylab(&quot;高速燃油率（mpg）&quot;)</span></span>
<span id="cb156-5"><a href="可视化与建模.html#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
</div>
<div id="设置坐标轴范围" class="section level4" number="4.1.3.3">
<h4><span class="header-section-number">4.1.3.3</span> 设置坐标轴范围</h4>
<p>用coord_cartesian() 函数的参数xlim 和ylim, 或者用xlim(), ylim() 函数，设置x 轴和y 轴的范围</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="可视化与建模.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy))<span class="sc">+</span></span>
<span id="cb157-2"><a href="可视化与建模.html#cb157-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>drv))<span class="sc">+</span></span>
<span id="cb157-3"><a href="可视化与建模.html#cb157-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">7</span>),<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">30</span>))<span class="co">#或+xlim(5,7)+ylim(10,30)</span></span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
</div>
<div id="变换坐标轴" class="section level4" number="4.1.3.4">
<h4><span class="header-section-number">4.1.3.4</span> 变换坐标轴</h4>
<p>变换数据再绘图，比如对数变换，坐标刻度也会变成变换之后的，这使得图形不好理解。</p>
<p>ggplot2 提供的坐标变换函数scale_x_log10()等是变换坐标系，能够在视觉效果相同的情况下，使用原始数据的坐标刻度：</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="可视化与建模.html#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;datas/gapminder.rda&quot;</span>)</span>
<span id="cb158-2"><a href="可视化与建模.html#cb158-2" aria-hidden="true" tabindex="-1"></a>p<span class="ot">=</span><span class="fu">ggplot</span>(gapminder,<span class="fu">aes</span>(gdpPercap, lifeExp)) <span class="sc">+</span></span>
<span id="cb158-3"><a href="可视化与建模.html#cb158-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb158-4"><a href="可视化与建模.html#cb158-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>()</span>
<span id="cb158-5"><a href="可视化与建模.html#cb158-5" aria-hidden="true" tabindex="-1"></a>p<span class="sc">+</span><span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="可视化与建模.html#cb160-1" aria-hidden="true" tabindex="-1"></a>p<span class="sc">+</span><span class="fu">scale_x_log10</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar)</span></code></pre></div>
<pre><code>## `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</code></pre>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
</div>
<div id="设置图形标题" class="section level4" number="4.1.3.5">
<h4><span class="header-section-number">4.1.3.5</span> 设置图形标题</h4>
<p>用labs() 函数的参数title, subtitle, caption设置标题、副标题、脚注标题（默认右下角）：</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="可视化与建模.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy))<span class="sc">+</span></span>
<span id="cb162-2"><a href="可视化与建模.html#cb162-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>drv))<span class="sc">+</span></span>
<span id="cb162-3"><a href="可视化与建模.html#cb162-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb162-4"><a href="可视化与建模.html#cb162-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;燃油效率随引擎大小的变化图&quot;</span>,</span>
<span id="cb162-5"><a href="可视化与建模.html#cb162-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;两座车(跑车) 因重量小而符合预期&quot;</span>,</span>
<span id="cb162-6"><a href="可视化与建模.html#cb162-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">&quot;数据来自fueleconomy.gov&quot;</span>)<span class="sc">+</span></span>
<span id="cb162-7"><a href="可视化与建模.html#cb162-7" aria-hidden="true" tabindex="-1"></a>  <span class="co">#国外习惯图形标题位于顶部左端，如果想改成顶部居中，需要加theme 图层专门设置</span></span>
<span id="cb162-8"><a href="可视化与建模.html#cb162-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb162-9"><a href="可视化与建模.html#cb162-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="设置fill-color-颜色" class="section level4" number="4.1.3.6">
<h4><span class="header-section-number">4.1.3.6</span> 设置fill, color 颜色</h4>
<p>数据的某个维度信息可以通过颜色来展示，颜色直接影响图形的美感。可以直接使用颜色值，但是更建议使用RColorBrewer（调色板）或colorspace 包。</p>
<ol style="list-style-type: decimal">
<li>离散变量</li>
</ol>
<ul>
<li>manual: 直接指定分组使用的颜色</li>
<li>hue: 通过改变色相(hue) 饱和度(chroma) 亮度(luminosity) 来调整颜色</li>
<li>brewer: 使用ColorBrewer 的颜色</li>
<li>grey: 使用不同程度的灰色</li>
</ul>
<p>用scale_*_manual()手动设置颜色，并修改图例及其标签：</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="可视化与建模.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy,<span class="at">color=</span>drv))<span class="sc">+</span></span>
<span id="cb163-2"><a href="可视化与建模.html#cb163-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb163-3"><a href="可视化与建模.html#cb163-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="st">&quot;驱动方式&quot;</span>, <span class="co">#修改图例名</span></span>
<span id="cb163-4"><a href="可视化与建模.html#cb163-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>,<span class="st">&quot;blue&quot;</span>,<span class="st">&quot;green&quot;</span>),</span>
<span id="cb163-5"><a href="可视化与建模.html#cb163-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;4&quot;</span>,<span class="st">&quot;f&quot;</span>,<span class="st">&quot;r&quot;</span>),</span>
<span id="cb163-6"><a href="可视化与建模.html#cb163-6" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;四驱&quot;</span>,<span class="st">&quot;前驱&quot;</span>,<span class="st">&quot;后驱&quot;</span>))</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-19-1.png" width="672" />
用scale_*_brewer() 调用调色版中的颜色：</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="可视化与建模.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(<span class="at">x=</span>class,<span class="at">fill=</span>class))<span class="sc">+</span></span>
<span id="cb164-2"><a href="可视化与建模.html#cb164-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb164-3"><a href="可视化与建模.html#cb164-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Dark2&quot;</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>查看所有可用的调色版：RColorBrewer::display.brewer.all()。</p>
<ol start="2" style="list-style-type: decimal">
<li>连续变量</li>
</ol>
<ul>
<li>gradient: 设置二色渐变色</li>
<li>gradient2: 设置三色渐变色</li>
<li>distiller: 使用ColorBrewer 的颜色</li>
<li>identity 使用color变量对应的颜色，对离散型和连续型都有效</li>
</ul>
<p>用scale_color_gradient() 设置二色渐变色：</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="可视化与建模.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy, <span class="at">color =</span> hwy)) <span class="sc">+</span></span>
<span id="cb165-2"><a href="可视化与建模.html#cb165-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb165-3"><a href="可视化与建模.html#cb165-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low=</span><span class="st">&quot;green&quot;</span>,<span class="at">high =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>用scale_*_distiller() 调用调色版中的颜色：</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="可视化与建模.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy, <span class="at">color =</span> hwy)) <span class="sc">+</span></span>
<span id="cb166-2"><a href="可视化与建模.html#cb166-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb166-3"><a href="可视化与建模.html#cb166-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_distiller</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
<div id="添加文字标注" class="section level4" number="4.1.3.7">
<h4><span class="header-section-number">4.1.3.7</span> 添加文字标注</h4>
<p>ggrepel 包提供了geom_label_repel() 和geom_text_repel() 函数，为图形添加文字标注。</p>
<p>首先要准备好标记点的数据，然后增加文字标注的图层，需要提供标记点数据，以及要标注的文字给label 美学，若来自数据变量，则需要用映射。</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="可视化与建模.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)</span>
<span id="cb167-2"><a href="可视化与建模.html#cb167-2" aria-hidden="true" tabindex="-1"></a>best_in_class<span class="ot">=</span>mpg <span class="sc">%&gt;%</span> <span class="do">## 选取每种车型hwy 值最大的样本</span></span>
<span id="cb167-3"><a href="可视化与建模.html#cb167-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">%&gt;%</span></span>
<span id="cb167-4"><a href="可视化与建模.html#cb167-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(hwy,<span class="at">n=</span><span class="dv">1</span>)</span>
<span id="cb167-5"><a href="可视化与建模.html#cb167-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-6"><a href="可视化与建模.html#cb167-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy))<span class="sc">+</span></span>
<span id="cb167-7"><a href="可视化与建模.html#cb167-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>class))<span class="sc">+</span></span>
<span id="cb167-8"><a href="可视化与建模.html#cb167-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_label_repel</span>(<span class="at">data =</span> best_in_class,<span class="fu">aes</span>(<span class="at">label=</span> model))</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>若要在图形某坐标位置添加文本注释，则用annotate() 函数，需要提供添加文本的中心坐标位
置，和要添加的文字内容：</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="可视化与建模.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy))<span class="sc">+</span></span>
<span id="cb168-2"><a href="可视化与建模.html#cb168-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb168-3"><a href="可视化与建模.html#cb168-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">&quot;text&quot;</span>,<span class="at">x =</span> <span class="dv">6</span>,<span class="at">y =</span> <span class="dv">40</span>,</span>
<span id="cb168-4"><a href="可视化与建模.html#cb168-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">label=</span><span class="st">&quot;引擎越大</span><span class="sc">\n</span><span class="st">燃油效率越高!&quot;</span>,</span>
<span id="cb168-5"><a href="可视化与建模.html#cb168-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">size=</span><span class="dv">4</span>,<span class="at">color=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
</div>
<div id="统计变换statistics" class="section level3" number="4.1.4">
<h3><span class="header-section-number">4.1.4</span> 统计变换(Statistics)</h3>
<div id="为什么要做统计变换" class="section level4" number="4.1.4.1">
<h4><span class="header-section-number">4.1.4.1</span> 为什么要做统计变换</h4>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="可视化与建模.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> diamonds)<span class="sc">+</span></span>
<span id="cb169-2"><a href="可视化与建模.html#cb169-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>cut))</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-25-1.png" width="672" /></p>
<p>我们可以看到，mapping中只有cut映射到了x轴，并没有制定什么变量映射到y轴而图案中y轴的count变量在元素数据中是没有的答案是geom_bar在暗地里做了一个统计变换（stat），新生成了一个叫count的变量。</p>
</div>
<div id="统计变换stat与几何对象geom的关系" class="section level4" number="4.1.4.2">
<h4><span class="header-section-number">4.1.4.2</span> 统计变换（stat）与几何对象（geom）的关系</h4>
<p>大部分stat和geom之间是可以相互转换的
举个例子</p>
<p>画出每个class（车型）对应计数的柱状图。</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="可视化与建模.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(<span class="at">x =</span> class))<span class="sc">+</span></span>
<span id="cb170-2"><a href="可视化与建模.html#cb170-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb170-3"><a href="可视化与建模.html#cb170-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;用geom_bar画图&quot;</span>)</span>
<span id="cb170-4"><a href="可视化与建模.html#cb170-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(<span class="at">x =</span> class))<span class="sc">+</span></span>
<span id="cb170-5"><a href="可视化与建模.html#cb170-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_count</span>()<span class="sc">+</span></span>
<span id="cb170-6"><a href="可视化与建模.html#cb170-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;用stat_count画图&quot;</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-26-1.png" width="50%" /><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-26-2.png" width="50%" /></p>
<ul>
<li>geom_bar()和stat_count()是等价的。即geom_bar()默认的stat=“count”，stat_count()默认的geom=“bar”</li>
</ul>
<p>此外，我们也可以先手动变换好数据之后，再绘图。</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="可视化与建模.html#cb171-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> mpg <span class="sc">%&gt;%</span>  <span class="co">#手动变化数据，求每个class对应的合计</span></span>
<span id="cb171-2"><a href="可视化与建模.html#cb171-2" aria-hidden="true" tabindex="-1"></a>           <span class="fu">group_by</span>(class) <span class="sc">%&gt;%</span></span>
<span id="cb171-3"><a href="可视化与建模.html#cb171-3" aria-hidden="true" tabindex="-1"></a>           <span class="fu">summarise</span>(</span>
<span id="cb171-4"><a href="可视化与建模.html#cb171-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">n_class=</span><span class="fu">n</span>())</span>
<span id="cb171-5"><a href="可视化与建模.html#cb171-5" aria-hidden="true" tabindex="-1"></a>data</span></code></pre></div>
<pre><code>## # A tibble: 7 x 2
##   class      n_class
##   &lt;chr&gt;        &lt;int&gt;
## 1 2seater          5
## 2 compact         47
## 3 midsize         41
## 4 minivan         11
## 5 pickup          33
## 6 subcompact      35
## 7 suv             62</code></pre>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="可视化与建模.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data,<span class="fu">aes</span>(<span class="at">x =</span> class, <span class="at">y=</span>n_class))<span class="sc">+</span></span>
<span id="cb173-2"><a href="可视化与建模.html#cb173-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb173-3"><a href="可视化与建模.html#cb173-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;用geom_bar画图&quot;</span>)</span>
<span id="cb173-4"><a href="可视化与建模.html#cb173-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data,<span class="fu">aes</span>(<span class="at">x =</span> class, <span class="at">y=</span>n_class))<span class="sc">+</span></span>
<span id="cb173-5"><a href="可视化与建模.html#cb173-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>()<span class="sc">+</span></span>
<span id="cb173-6"><a href="可视化与建模.html#cb173-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;用geom_col画图&quot;</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-27-1.png" width="50%" /><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-27-2.png" width="50%" /></p>
<ul>
<li>在geom_bar()函数中更改stat参数从默认的”count”为”identity”后，和geom_col()函数等价，因为geom_col()函数默认的stat参数取值为”identity”。</li>
</ul>
<p>例子二：绘制每个class对应出displ的合计。</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="可视化与建模.html#cb174-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> (mpg <span class="sc">%&gt;%</span>  <span class="co"># class的displ的求和</span></span>
<span id="cb174-2"><a href="可视化与建模.html#cb174-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(class) <span class="sc">%&gt;%</span></span>
<span id="cb174-3"><a href="可视化与建模.html#cb174-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb174-4"><a href="可视化与建模.html#cb174-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_displ=</span><span class="fu">sum</span>(displ)</span>
<span id="cb174-5"><a href="可视化与建模.html#cb174-5" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb174-6"><a href="可视化与建模.html#cb174-6" aria-hidden="true" tabindex="-1"></a>data</span></code></pre></div>
<pre><code>## # A tibble: 7 x 2
##   class      n_displ
##   &lt;chr&gt;        &lt;dbl&gt;
## 1 2seater       30.8
## 2 compact      109. 
## 3 midsize      120. 
## 4 minivan       37.3
## 5 pickup       146. 
## 6 subcompact    93.1
## 7 suv          276.</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="可视化与建模.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> data,<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> class,<span class="at">y =</span> n_displ))<span class="sc">+</span></span>
<span id="cb176-2"><a href="可视化与建模.html#cb176-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb176-3"><a href="可视化与建模.html#cb176-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;用自己手动变换数据做出来的条形图&quot;</span>)</span>
<span id="cb176-4"><a href="可视化与建模.html#cb176-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(<span class="at">x=</span>class,<span class="at">y=</span>displ)) <span class="sc">+</span></span>
<span id="cb176-5"><a href="可视化与建模.html#cb176-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>)<span class="sc">+</span></span>
<span id="cb176-6"><a href="可视化与建模.html#cb176-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;用stata=&#39;identity&#39;变换做出来的条形图&quot;</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-28-1.png" width="50%" /><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-28-2.png" width="50%" /></p>
<ul>
<li>geom_bar()的position参数默认使用stack堆叠的方式，将所有柱子堆积成一根柱子,相当于对displ求和。</li>
</ul>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="可视化与建模.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(<span class="at">x=</span>class,<span class="at">y=</span>displ)) <span class="sc">+</span></span>
<span id="cb177-2"><a href="可视化与建模.html#cb177-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_identity</span>() <span class="co"># 散点图</span></span>
<span id="cb177-3"><a href="可视化与建模.html#cb177-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(<span class="at">x=</span>class,<span class="at">y=</span>displ)) <span class="sc">+</span></span>
<span id="cb177-4"><a href="可视化与建模.html#cb177-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="co"># 等价于上一条</span></span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-29-1.png" width="50%" /><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-29-2.png" width="50%" /></p>
<ul>
<li>geom_point和stat_identity互相默认，即geom_point()函数的stata参数的默认取值为”identity”，stat_indentity()函数的geom参数的默认取值为”point”。</li>
</ul>
</div>
<div id="stat与geom的定义及使用" class="section level4" number="4.1.4.3">
<h4><span class="header-section-number">4.1.4.3</span> stat与geom的定义及使用</h4>
<p>要理解stat和geom内部的运行机制，我们可以看ggplot2包中的User guides, package vignettes and other documentation.里面的文章 <a href="https://ggplot2.tidyverse.org/articles/extending-ggplot2.html" target="_blank">extending-ggplot2</a>和<a href="https://zhuanlan.zhihu.com/p/29553873" target="_blank">知乎专栏</a>。这篇文章介绍了如何自己创建一个新的geom和新的stat，创建新的函数需要我们遇到具体问题时才要去做的事情，在这里我只想通过理解它的创建过程，来理解原有函数之间的关系。</p>
</div>
<div id="统计变换" class="section level4" number="4.1.4.4">
<h4><span class="header-section-number">4.1.4.4</span> 统计变换</h4>
<p>构建新的统计量进而绘图，称为‘‘统计变换’’，简称‘‘统计’’。比如，条形图、直方图都是先对数
据分组，再计算分组频数（落在每组的样本点数）绘图；箱线图计算稳健的分布汇总，并用特殊盒子
展示出来；平滑曲线用来根据数据拟合模型，进而绘制模型预测值. . . . . .</p>
<p>ggplot2 强大的一点就是，把统计变换直接融入绘图语法中，而不必先在外面对数据做统计变换，
再回来绘图。</p>
<p>ggplot2 中的提供了30 多种‘‘统计’’，均以stat_xxxx() 的方式命名。可以分为两类：</p>
<ul>
<li>可以在几何对象函数geom_*() 中创建，通常直接使用后者即可
<ul>
<li>stat_bin()：geom_bar，geom_freqploy()，geom_histogram()</li>
<li>stat_bindot()：geom_dotplot()</li>
<li>stat_boxplot()：geom_box_plot()</li>
<li>stat_contour()：geom_contour()</li>
<li>stat_quantile()：geom_quantile()</li>
<li>stat_smooth()：geom_smmoth()</li>
<li>stat_sum()：geom_count()</li>
</ul></li>
<li>不能在几何对象函数geom_*() 中创建：
<ul>
<li>stat_ecdf(): 计算经验累积分布图</li>
<li>stat_function(): 根据x 值的函数计算y 值</li>
<li>stat_summary(): 在x 唯一值处汇总y 值</li>
<li>stat_qq(): 执行Q-Q 图计算</li>
<li>stat_spoke(): 转换极坐标的角度和半径为直角坐标位置</li>
<li>stat_unique(): 剔除重复行</li>
</ul></li>
</ul>
<p>用stat_summary() 做统计汇总并绘图。通过传递函数做统计计算，首先注意x 和y 美学映射到calss 和hwy; fun = mean是根据x计算y，故对每个车型计算一个平均的hwy；fun.max, fun.min 同样根据x分别计算y的均值加减标准差；统计计算的结果将传递给几何对象参数geom 用于绘图：</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="可视化与建模.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(<span class="at">x =</span> class,<span class="at">y =</span> hwy))<span class="sc">+</span></span>
<span id="cb178-2"><a href="可视化与建模.html#cb178-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>(<span class="at">trim =</span> <span class="cn">FALSE</span>,<span class="at">alpha=</span><span class="fl">0.5</span>,<span class="at">color=</span><span class="st">&quot;green&quot;</span>)<span class="sc">+</span></span>
<span id="cb178-3"><a href="可视化与建模.html#cb178-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun=</span>mean,</span>
<span id="cb178-4"><a href="可视化与建模.html#cb178-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">fun.min =</span> <span class="cf">function</span>(x){<span class="fu">mean</span>(x)<span class="sc">-</span><span class="fu">sd</span>(x)},</span>
<span id="cb178-5"><a href="可视化与建模.html#cb178-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">fun.max =</span> <span class="cf">function</span>(x){<span class="fu">mean</span>(x)<span class="sc">+</span><span class="fu">sd</span>(x)},</span>
<span id="cb178-6"><a href="可视化与建模.html#cb178-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">geom =</span> <span class="st">&quot;pointrange&quot;</span>,<span class="at">color=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-30-1.png" width="672" />
用stat_smooth(), 与geom_smooth() 相同, 添加光滑曲线：</p>
<ul>
<li>method: 指定平滑曲线的统计函数，如lm 线性回归, glm 广义线性回归, loess 多项式回归, gam 广义加法模型(mgcv 包) , rlm 稳健回归(MASS 包) 等</li>
<li>formula: 指定平滑曲线的方程，如y ~ x, y ~ poly(x, 2), y ~ log(x) ，需要与method 参数搭配使用</li>
<li>se: 设置是否绘制置信区间</li>
</ul>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="可视化与建模.html#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy))<span class="sc">+</span></span>
<span id="cb179-2"><a href="可视化与建模.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb179-3"><a href="可视化与建模.html#cb179-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb179-4"><a href="可视化与建模.html#cb179-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> y<span class="sc">~</span>splines<span class="sc">::</span><span class="fu">bs</span>(x,<span class="dv">3</span>),</span>
<span id="cb179-5"><a href="可视化与建模.html#cb179-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
</div>
</div>
<div id="坐标系coordinante" class="section level3" number="4.1.5">
<h3><span class="header-section-number">4.1.5</span> 坐标系(Coordinante)</h3>
<p>ggplot2 默认坐标系是笛卡尔直角坐标系coord_cartesian()，常用的坐标系操作还有：</p>
<ul>
<li>coord_flip()：坐标轴翻转，即x 轴与y轴互换，比如绘制水平条形图</li>
<li>coord_fixed(): 固定ratio = y / x 的比例</li>
<li>coord_polar()：转化为极坐标系，比如条形图转为极坐标系即为饼图</li>
<li>coord_trans(): 彻底的坐标变换，不同于scale_x_log10() 等</li>
<li>coord_map(), coord_quickmap(): 与geom_polygon() 连用，控制地图的坐标投影</li>
<li>coord_sf(): 与geom_sf() 连用，控制地图的坐标投影</li>
</ul>
<p>坐标轴翻转，从水平图到竖直图：</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="可视化与建模.html#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(class,hwy))<span class="sc">+</span></span>
<span id="cb180-2"><a href="可视化与建模.html#cb180-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()<span class="sc">+</span>  <span class="co">#箱线图</span></span>
<span id="cb180-3"><a href="可视化与建模.html#cb180-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()     <span class="co"># 从竖直变成水平</span></span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
<p>直角坐标下的条形图，转化为极坐标下的风玫瑰图：</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="可视化与建模.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(class,<span class="at">fill=</span>drv))<span class="sc">+</span></span>
<span id="cb181-2"><a href="可视化与建模.html#cb181-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()<span class="sc">+</span></span>
<span id="cb181-3"><a href="可视化与建模.html#cb181-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>()</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
</div>
<div id="位置调整position-adjustments" class="section level3" number="4.1.6">
<h3><span class="header-section-number">4.1.6</span> 位置调整(Position adjustments)</h3>
<p>条形图中的条形位置调整：</p>
<ul>
<li>position_stack(): 竖直堆叠</li>
<li>position_fill(): 竖直(百分比) 堆叠，按比例放缩保证总高度为1</li>
<li>position_dodge(), position_dodge2(): 水平堆叠</li>
</ul>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="可视化与建模.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(class,<span class="at">fill=</span>drv))<span class="sc">+</span></span>
<span id="cb182-2"><a href="可视化与建模.html#cb182-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">preserve =</span> <span class="st">&quot;single&quot;</span>))</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>散点图中的散点位置调整：</p>
<ul>
<li>position_nudge(): 将散点移动固定的偏移量</li>
<li>position_jitter(): 给每个散点增加一点随机噪声(抖散图)</li>
<li>position_jitterdodge(): 增加一点随机噪声并躲避组内的点，特别用于箱线图+ 散点图</li>
</ul>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="可视化与建模.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy))<span class="sc">+</span></span>
<span id="cb183-2"><a href="可视化与建模.html#cb183-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="st">&quot;jitter&quot;</span>) <span class="co"># 避免有散点重叠</span></span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>有时候需要将多个图形排布在画板中，借助patchwork 包更方便。</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="可视化与建模.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span></code></pre></div>
<pre><code>## Warning: 程辑包&#39;patchwork&#39;是用R版本4.1.2 来建造的</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="可视化与建模.html#cb186-1" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">=</span> <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy)) <span class="sc">+</span></span>
<span id="cb186-2"><a href="可视化与建模.html#cb186-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb186-3"><a href="可视化与建模.html#cb186-3" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">=</span> <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(drv, displ)) <span class="sc">+</span></span>
<span id="cb186-4"><a href="可视化与建模.html#cb186-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb186-5"><a href="可视化与建模.html#cb186-5" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">=</span> <span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(drv)) <span class="sc">+</span></span>
<span id="cb186-6"><a href="可视化与建模.html#cb186-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span>
<span id="cb186-7"><a href="可视化与建模.html#cb186-7" aria-hidden="true" tabindex="-1"></a>p1<span class="sc">|</span>(p2<span class="sc">/</span>p3)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
</div>
<div id="分面facet" class="section level3" number="4.1.7">
<h3><span class="header-section-number">4.1.7</span> 分面(Facet)</h3>
<p>利用分类变量将图形分为若干个“面” （子图），即对数据分组再分别绘图，称为“分面”</p>
<ol style="list-style-type: decimal">
<li>facet_wrap()</li>
</ol>
<p>封装分面，先生成一维的面板系列，再封装到二维中。</p>
<ul>
<li>分面形式：~ 分类变量, ~ 分类变量1 + 分类变量2</li>
<li>scales 参数设置是否共用坐标刻度，“fixed”（默认, 共用）, “free”（不共用），也可以用free_x,free_y 单独设置</li>
<li>参数nrow 和ncol 可设置子图的放置方式</li>
</ul>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="可视化与建模.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy))<span class="sc">+</span></span>
<span id="cb187-2"><a href="可视化与建模.html#cb187-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb187-3"><a href="可视化与建模.html#cb187-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="sc">~</span>drv,<span class="at">scales =</span> <span class="st">&quot;fixed&quot;</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="可视化与建模.html#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy))<span class="sc">+</span></span>
<span id="cb188-2"><a href="可视化与建模.html#cb188-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb188-3"><a href="可视化与建模.html#cb188-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="sc">~</span>drv<span class="sc">+</span>cyl,<span class="at">scales =</span> <span class="st">&quot;fixed&quot;</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-38-1.png" width="672" /></p>
<ol start="2" style="list-style-type: decimal">
<li>facet_grid()</li>
</ol>
<p>网格分面，生成二维的面板网格，面板的行与列通过分面变量定义。</p>
<ul>
<li>分面形式：行分类变量~ 列分类变量</li>
</ul>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="可视化与建模.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy))<span class="sc">+</span></span>
<span id="cb189-2"><a href="可视化与建模.html#cb189-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb189-3"><a href="可视化与建模.html#cb189-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(drv<span class="sc">~</span>cyl)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
</div>
<div id="主题theme" class="section level3" number="4.1.8">
<h3><span class="header-section-number">4.1.8</span> 主题(theme)</h3>
<ul>
<li>theme_bw()</li>
<li>theme_light()</li>
<li>theme_classic()</li>
<li>theme_gray(): 默认</li>
<li>theme_linedraw()</li>
<li>theme_dark()</li>
<li>theme_minimal()</li>
<li>theme_void()</li>
</ul>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="可视化与建模.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, hwy, <span class="at">color =</span> drv)) <span class="sc">+</span></span>
<span id="cb190-2"><a href="可视化与建模.html#cb190-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb190-3"><a href="可视化与建模.html#cb190-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>更多的主题，还可以用ggthemes 包，其中包含一些顶级期刊专用绘图主题；当然也可以用theme()函数定制自己的主题（略）。</p>
</div>
<div id="输出output" class="section level3" number="4.1.9">
<h3><span class="header-section-number">4.1.9</span> 输出(output)</h3>
<p>用ggsave() 函数，将当前图形保存为想要格式的图形文件，如png, pdf 等：</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="可视化与建模.html#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="st">&quot;my_plot.pdf&quot;</span>, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>) <span class="do">##保存当前图形为pdf格式</span></span></code></pre></div>
<p>最后，再补充一点关于图形中使用中文字体导出到pdf 等图形文件出现乱码问题的解决办法。</p>
<p>出现中文乱码是因为R 环境只载入了“sans (Arial),” “serif (Times New Roman),” “mono (Courier
New)” 三种英文字体，没有中文字体可用。</p>
<p>解决办法就是从系统字体中载入中文字体，用showtext 包（依赖sysfonts 包）更简单一些。</p>
<ul>
<li>font_paths(): 查看系统字体路径，windows 默认是C:</li>
<li>font_files(): 查看系统自带的所有字体文件</li>
<li>font_add(): 从系统字体中载入字体，需提供family 名字，字体路径</li>
</ul>
<p>载入字体后，再执行一下showtext_auto() (启用/关闭功能), 就可以使用该字体了。</p>
<p>ggpplot2 中各种设置主题、文本相关的函数*_text(), annotate() 等，都提供了family 参数，设定为font_add() 中一致的family 名字即可。</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="可视化与建模.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(showtext)</span></code></pre></div>
<pre><code>## Warning: 程辑包&#39;showtext&#39;是用R版本4.1.2 来建造的</code></pre>
<pre><code>## 载入需要的程辑包：sysfonts</code></pre>
<pre><code>## Warning: 程辑包&#39;sysfonts&#39;是用R版本4.1.2 来建造的</code></pre>
<pre><code>## 载入需要的程辑包：showtextdb</code></pre>
<pre><code>## Warning: 程辑包&#39;showtextdb&#39;是用R版本4.1.2 来建造的</code></pre>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="可视化与建模.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">font_add</span>(<span class="st">&quot;heiti&quot;</span>, <span class="st">&quot;simhei.ttf&quot;</span>)</span>
<span id="cb198-2"><a href="可视化与建模.html#cb198-2" aria-hidden="true" tabindex="-1"></a><span class="fu">font_add</span>(<span class="st">&quot;kaiti&quot;</span>, <span class="st">&quot;simkai.ttf&quot;</span>)</span>
<span id="cb198-3"><a href="可视化与建模.html#cb198-3" aria-hidden="true" tabindex="-1"></a><span class="fu">showtext_auto</span>()</span>
<span id="cb198-4"><a href="可视化与建模.html#cb198-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb198-5"><a href="可视化与建模.html#cb198-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy,<span class="at">color=</span>drv))<span class="sc">+</span></span>
<span id="cb198-6"><a href="可视化与建模.html#cb198-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb198-7"><a href="可视化与建模.html#cb198-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;heiti&quot;</span>),</span>
<span id="cb198-8"><a href="可视化与建模.html#cb198-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">family =</span> <span class="st">&quot;kaiti&quot;</span>))<span class="sc">+</span></span>
<span id="cb198-9"><a href="可视化与建模.html#cb198-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot; 发动机排量(L)&quot;</span>) <span class="sc">+</span></span>
<span id="cb198-10"><a href="可视化与建模.html#cb198-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot; 高速里程数(mpg)&quot;</span>) <span class="sc">+</span></span>
<span id="cb198-11"><a href="可视化与建模.html#cb198-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot; 汽车发动机排量与高速里程数&quot;</span>) <span class="sc">+</span></span>
<span id="cb198-12"><a href="可视化与建模.html#cb198-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="dv">5</span>, <span class="dv">35</span>, <span class="at">family =</span> <span class="st">&quot;kaiti&quot;</span>, <span class="at">size =</span> <span class="dv">8</span>,</span>
<span id="cb198-13"><a href="可视化与建模.html#cb198-13" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">&quot; 设置中文字体&quot;</span>, <span class="at">color =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
</div>
<div id="export包将ggplot或latice输出为ppt" class="section level3" number="4.1.10">
<h3><span class="header-section-number">4.1.10</span> export包(将ggplot或latice输出为PPT)</h3>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="可视化与建模.html#cb199-1" aria-hidden="true" tabindex="-1"></a>export<span class="sc">::</span><span class="fu">graph2ppt</span>(<span class="at">x=</span>p<span class="sc">$</span>plot,</span>
<span id="cb199-2"><a href="可视化与建模.html#cb199-2" aria-hidden="true" tabindex="-1"></a>                  <span class="at">file=</span><span class="st">&quot;F:/wlzp/AD_KM/p.pptx&quot;</span>, <span class="at">width=</span><span class="dv">5</span>, <span class="at">height=</span><span class="dv">3</span>)</span></code></pre></div>
</div>
</div>
<div id="自定义ggplot2函数" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> 自定义ggplot2函数</h2>
<div id="为什么要自定义ggplot函数" class="section level3" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> 为什么要自定义ggplot函数</h3>
<p>每次在用ggplot函数绘图时，如果你只需要改变一个参数，每次都要复制粘贴所有绘图代码很麻烦。为了使您的代码更加灵活，您需要通过编写函数来减少重复代码。</p>
</div>
<div id="单个组件" class="section level3" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> 单个组件</h3>
<p>方法一：重复使用的代码片段存为对象</p>
<p>ggplot图的每个组件都是一个对象。大多数情况下，我们创建组件并立即将其添加到绘图中，但其实并不需要这么做。相反，我们可以将任何组件保存为一个变量（给它一个名字），然后将它添加到多个绘图中:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb200-1"><a href="可视化与建模.html#cb200-1" aria-hidden="true" tabindex="-1"></a>bestfit <span class="ot">&lt;-</span> <span class="fu">geom_smooth</span>(</span>
<span id="cb200-2"><a href="可视化与建模.html#cb200-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,</span>
<span id="cb200-3"><a href="可视化与建模.html#cb200-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">se=</span><span class="cn">FALSE</span>,</span>
<span id="cb200-4"><a href="可视化与建模.html#cb200-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">colour=</span><span class="fu">alpha</span>(<span class="st">&quot;steelblue&quot;</span>,<span class="fl">0.5</span>),</span>
<span id="cb200-5"><a href="可视化与建模.html#cb200-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">size=</span><span class="dv">2</span></span>
<span id="cb200-6"><a href="可视化与建模.html#cb200-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb200-7"><a href="可视化与建模.html#cb200-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(cty,hwy))<span class="sc">+</span></span>
<span id="cb200-8"><a href="可视化与建模.html#cb200-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb200-9"><a href="可视化与建模.html#cb200-9" aria-hidden="true" tabindex="-1"></a>  bestfit</span>
<span id="cb200-10"><a href="可视化与建模.html#cb200-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,hwy))<span class="sc">+</span></span>
<span id="cb200-11"><a href="可视化与建模.html#cb200-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb200-12"><a href="可视化与建模.html#cb200-12" aria-hidden="true" tabindex="-1"></a>  bestfit</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/figures-side-1.png" width="50%" /><img src="1003-chapter03-VisualizationModel_files/figure-html/figures-side-2.png" width="50%" /></p>
<p>这是减少简单复制类型的一种方法(比复制粘贴好多了!)，但要求组件每次都完全相同。如果需要更大的灵活性，可以将这些可重复使用的代码片段放在在一个函数中。</p>
<p><strong>方法二：重复使用的代码片段放在函数</strong></p>
<p>例如，我们可以扩展<code>bestfit</code>对象成一个更普适性的函数，给图中增加一条最佳拟合线。下面的代码创建了一个<code>geom_lm()</code>函数，有三个参数，模型的<code>formula</code>，拟合线条的<code>color</code>和拟合线的粗细<code>size</code>：</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="可视化与建模.html#cb201-1" aria-hidden="true" tabindex="-1"></a>geom_lm <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">formula=</span>y<span class="sc">~</span>x,<span class="at">color=</span><span class="fu">alpha</span>(<span class="st">&quot;steelblue&quot;</span>,<span class="fl">0.5</span>),</span>
<span id="cb201-2"><a href="可视化与建模.html#cb201-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">size=</span><span class="dv">2</span>,...){</span>
<span id="cb201-3"><a href="可视化与建模.html#cb201-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">formula =</span> formula,<span class="at">se=</span><span class="cn">FALSE</span>,<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>,<span class="at">color=</span>color,</span>
<span id="cb201-4"><a href="可视化与建模.html#cb201-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">size=</span>size,...)</span>
<span id="cb201-5"><a href="可视化与建模.html#cb201-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb201-6"><a href="可视化与建模.html#cb201-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg, <span class="fu">aes</span>(displ, <span class="dv">1</span> <span class="sc">/</span> hwy)) <span class="sc">+</span></span>
<span id="cb201-7"><a href="可视化与建模.html#cb201-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb201-8"><a href="可视化与建模.html#cb201-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_lm</span>()</span>
<span id="cb201-9"><a href="可视化与建模.html#cb201-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(mpg,<span class="fu">aes</span>(displ,<span class="dv">1</span><span class="sc">/</span>hwy))<span class="sc">+</span></span>
<span id="cb201-10"><a href="可视化与建模.html#cb201-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb201-11"><a href="可视化与建模.html#cb201-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_lm</span>(y <span class="sc">~</span> <span class="fu">poly</span>(x,<span class="dv">2</span>),<span class="at">size=</span><span class="dv">1</span>,<span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="co">#等价于formula = y~x+I(x^2)</span></span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-44-1.png" width="50%" /><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-44-2.png" width="50%" /></p>
<p>请注意”…“的用法。 在函数中定义缺省参数”…“允许函数接受任意的附加参数。 在函数内部，你可以使用”…” 将这些参数传递给另一个函数。 本例中，将”…“传递到<code>geom_smooth()</code>中，这样就可以修改我们没有显式覆盖的其他参数。 当编写自己的组件函数时，最好总是使用“…” 这种方式。</p>
</div>
<div id="多个组件" class="section level3" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> 多个组件</h3>
</div>
</div>
<div id="散点图" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> 散点图</h2>
<div id="密度散点图" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> 密度散点图</h3>
<p>绘制散点图时，若散点数目很多，散点之间相互重叠，则不易观察散点趋势，此时可绘制密度散点图解决。</p>
<p><strong>加载R包并生成相关数据</strong></p>
<div class="sourceCode" id="cb202"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb202-1"><a href="可视化与建模.html#cb202-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb202-2"><a href="可视化与建模.html#cb202-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb202-3"><a href="可视化与建模.html#cb202-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis) <span class="co"># 使用viridis提供的翠绿色标度：scale_fill_viridis()</span></span>
<span id="cb202-4"><a href="可视化与建模.html#cb202-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpointdensity) <span class="co"># 绘制密度散点图</span></span>
<span id="cb202-5"><a href="可视化与建模.html#cb202-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cowplot) <span class="co"># 图形组合，可以自动对其坐标轴</span></span>
<span id="cb202-6"><a href="可视化与建模.html#cb202-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb202-7"><a href="可视化与建模.html#cb202-7" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(</span>
<span id="cb202-8"><a href="可视化与建模.html#cb202-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">7000</span>, <span class="at">sd =</span> <span class="dv">1</span>),</span>
<span id="cb202-9"><a href="可视化与建模.html#cb202-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">7000</span>, <span class="at">sd =</span> <span class="dv">10</span>),</span>
<span id="cb202-10"><a href="可视化与建模.html#cb202-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="st">&quot;foo&quot;</span>),</span>
<span id="cb202-11"><a href="可视化与建模.html#cb202-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">3000</span>, <span class="at">mean =</span> <span class="dv">1</span>, <span class="at">sd =</span> .<span class="dv">5</span>),</span>
<span id="cb202-12"><a href="可视化与建模.html#cb202-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">3000</span>, <span class="at">mean =</span> <span class="dv">7</span>, <span class="at">sd =</span> <span class="dv">5</span>),</span>
<span id="cb202-13"><a href="可视化与建模.html#cb202-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">group =</span> <span class="st">&quot;bar&quot;</span>))</span></code></pre></div>
<p><strong>绘图</strong></p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="可视化与建模.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 散点图</span></span>
<span id="cb203-2"><a href="可视化与建模.html#cb203-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb203-3"><a href="可视化与建模.html#cb203-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb203-4"><a href="可视化与建模.html#cb203-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">tag =</span> <span class="st">&quot;A&quot;</span>) <span class="sc">+</span> <span class="co"># 添加子图标记</span></span>
<span id="cb203-5"><a href="可视化与建模.html#cb203-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb203-6"><a href="可视化与建模.html#cb203-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-7"><a href="可视化与建模.html#cb203-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 散点图+密度线（geom_density2d）</span></span>
<span id="cb203-8"><a href="可视化与建模.html#cb203-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb203-9"><a href="可视化与建模.html#cb203-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb203-10"><a href="可视化与建模.html#cb203-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density2d</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb203-11"><a href="可视化与建模.html#cb203-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">tag =</span> <span class="st">&quot;B&quot;</span>) <span class="sc">+</span></span>
<span id="cb203-12"><a href="可视化与建模.html#cb203-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb203-13"><a href="可视化与建模.html#cb203-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-14"><a href="可视化与建模.html#cb203-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 封箱散点图（geom_bin2d）</span></span>
<span id="cb203-15"><a href="可视化与建模.html#cb203-15" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb203-16"><a href="可视化与建模.html#cb203-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bin2d</span>(<span class="at">bins =</span> <span class="dv">60</span>) <span class="sc">+</span> <span class="co"># bins控制着图中每个箱子的大小</span></span>
<span id="cb203-17"><a href="可视化与建模.html#cb203-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>() <span class="sc">+</span></span>
<span id="cb203-18"><a href="可视化与建模.html#cb203-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">tag =</span> <span class="st">&quot;C&quot;</span>) <span class="sc">+</span></span>
<span id="cb203-19"><a href="可视化与建模.html#cb203-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb203-20"><a href="可视化与建模.html#cb203-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-21"><a href="可视化与建模.html#cb203-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 密度散点图（geom_pointdensity）</span></span>
<span id="cb203-22"><a href="可视化与建模.html#cb203-22" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb203-23"><a href="可视化与建模.html#cb203-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_pointdensity</span>() <span class="sc">+</span></span>
<span id="cb203-24"><a href="可视化与建模.html#cb203-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis</span>() <span class="sc">+</span></span>
<span id="cb203-25"><a href="可视化与建模.html#cb203-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">tag =</span> <span class="st">&quot;D&quot;</span>) <span class="sc">+</span></span>
<span id="cb203-26"><a href="可视化与建模.html#cb203-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_classic</span>()</span>
<span id="cb203-27"><a href="可视化与建模.html#cb203-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-28"><a href="可视化与建模.html#cb203-28" aria-hidden="true" tabindex="-1"></a><span class="co"># 组合4幅图形</span></span>
<span id="cb203-29"><a href="可视化与建模.html#cb203-29" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_grid</span>(p1, p2, p3, p4, <span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p><strong>4幅图的比较</strong></p>
<ul>
<li><p>geom_point为ggplot2自带的绘图函数；A图各位置点的数量观察不清</p></li>
<li><p>geom_density2d为ggplot2自带的绘图函数，可以绘制密度等高线（图B）</p></li>
<li><p>geom_bin2d为ggplot2自带的绘图函数；先将散点封箱处理，然后绘制出箱子，箱子的颜色取决于箱子内散点的数量（图C）</p></li>
<li><p>geom_pointdensity为ggpointdensity包的函数；各散点的颜色取决于改点周围临近点的数量（图D）
图C与图D效果类似，但图C的箱子已不再是真实的散点，而图D为真实的散点；比较图C、图D与原始图A的散点稀疏区域便可发现</p></li>
</ul>
</div>
</div>
<div id="生存分析" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> 生存分析</h2>
<p>前期数据处理</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb204-1"><a href="可视化与建模.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb204-2"><a href="可视化与建模.html#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb204-3"><a href="可视化与建模.html#cb204-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb204-4"><a href="可视化与建模.html#cb204-4" aria-hidden="true" tabindex="-1"></a>file1 <span class="ot">&lt;-</span> foreign<span class="sc">::</span><span class="fu">read.dta</span>(<span class="at">file =</span> <span class="st">&quot;F:/wlzp/AD_KM/file1.dta&quot;</span>)</span>
<span id="cb204-5"><a href="可视化与建模.html#cb204-5" aria-hidden="true" tabindex="-1"></a>file2 <span class="ot">&lt;-</span> foreign<span class="sc">::</span><span class="fu">read.dta</span>(<span class="at">file =</span> <span class="st">&quot;F:/wlzp/AD_KM/file2.dta&quot;</span>)</span>
<span id="cb204-6"><a href="可视化与建模.html#cb204-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-7"><a href="可视化与建模.html#cb204-7" aria-hidden="true" tabindex="-1"></a>data1 <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">grbm=</span>file1<span class="sc">$</span>grbm,</span>
<span id="cb204-8"><a href="可视化与建模.html#cb204-8" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dy90=</span>file1<span class="sc">$</span>signal90,</span>
<span id="cb204-9"><a href="可视化与建模.html#cb204-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dysj=</span>file1<span class="sc">$</span>timetg,</span>
<span id="cb204-10"><a href="可视化与建模.html#cb204-10" aria-hidden="true" tabindex="-1"></a>                        <span class="at">arm=</span>file1<span class="sc">$</span>cohort)</span>
<span id="cb204-11"><a href="可视化与建模.html#cb204-11" aria-hidden="true" tabindex="-1"></a>data2 <span class="ot">&lt;-</span> tibble<span class="sc">::</span><span class="fu">tibble</span>(<span class="at">grbm=</span>file2<span class="sc">$</span>grbm,</span>
<span id="cb204-12"><a href="可视化与建模.html#cb204-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dy90=</span>file2<span class="sc">$</span>signal90,</span>
<span id="cb204-13"><a href="可视化与建模.html#cb204-13" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dysj=</span>file2<span class="sc">$</span>timetg,</span>
<span id="cb204-14"><a href="可视化与建模.html#cb204-14" aria-hidden="true" tabindex="-1"></a>                        <span class="at">arm=</span>file2<span class="sc">$</span>cohort)</span>
<span id="cb204-15"><a href="可视化与建模.html#cb204-15" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(data1,data2) <span class="sc">%&gt;%</span></span>
<span id="cb204-16"><a href="可视化与建模.html#cb204-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cohort=</span><span class="fu">case_when</span>(arm<span class="sc">==</span><span class="dv">1</span> <span class="sc">~</span> <span class="st">&quot;treatment-naive&quot;</span>,</span>
<span id="cb204-17"><a href="可视化与建模.html#cb204-17" aria-hidden="true" tabindex="-1"></a>                       arm<span class="sc">==</span><span class="dv">2</span> <span class="sc">~</span> <span class="st">&quot;previously treated&quot;</span>,</span>
<span id="cb204-18"><a href="可视化与建模.html#cb204-18" aria-hidden="true" tabindex="-1"></a>                       arm<span class="sc">==</span><span class="dv">3</span> <span class="sc">~</span> <span class="st">&quot;totol&quot;</span></span>
<span id="cb204-19"><a href="可视化与建模.html#cb204-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-20"><a href="可视化与建模.html#cb204-20" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span></span>
<span id="cb204-21"><a href="可视化与建模.html#cb204-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>arm)</span></code></pre></div>
<p>画生存曲线</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="可视化与建模.html#cb205-1" aria-hidden="true" tabindex="-1"></a>fit<span class="ot">&lt;-</span><span class="fu">survfit</span>(<span class="fu">Surv</span>(dysj,dy90 <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">~</span>cohort,<span class="at">data =</span> data)</span>
<span id="cb205-2"><a href="可视化与建模.html#cb205-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggsurvplot</span>(fit,<span class="at">data =</span> data,</span>
<span id="cb205-3"><a href="可视化与建模.html#cb205-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">&quot;#E7B800&quot;</span>, <span class="st">&quot;#2E9FDF&quot;</span>,<span class="st">&quot;#F39902&quot;</span>),</span>
<span id="cb205-4"><a href="可视化与建模.html#cb205-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">conf.int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb205-5"><a href="可视化与建模.html#cb205-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">risk.table =</span> <span class="cn">FALSE</span>,</span>
<span id="cb205-6"><a href="可视化与建模.html#cb205-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">xlab=</span> <span class="st">&quot;proportion of persistence %&quot;</span>,</span>
<span id="cb205-7"><a href="可视化与建模.html#cb205-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">ylab=</span> <span class="st">&quot;proportion of persistence %&quot;</span>,</span>
<span id="cb205-8"><a href="可视化与建模.html#cb205-8" aria-hidden="true" tabindex="-1"></a>           <span class="at">ggtheme =</span> <span class="fu">theme_bw</span>(), <span class="co"># Change ggplot2 theme</span></span>
<span id="cb205-9"><a href="可视化与建模.html#cb205-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.title =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>),</span>
<span id="cb205-10"><a href="可视化与建模.html#cb205-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend=</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb205-11"><a href="可视化与建模.html#cb205-11" aria-hidden="true" tabindex="-1"></a>           <span class="at">legend.labs =</span> <span class="fu">c</span>(<span class="st">&quot;treatment-naive&quot;</span>,<span class="st">&quot;previously treated&quot;</span>,<span class="st">&quot;totol&quot;</span>),</span>
<span id="cb205-12"><a href="可视化与建模.html#cb205-12" aria-hidden="true" tabindex="-1"></a>           <span class="at">censor=</span><span class="cn">FALSE</span>)</span>
<span id="cb205-13"><a href="可视化与建模.html#cb205-13" aria-hidden="true" tabindex="-1"></a>export<span class="sc">::</span><span class="fu">graph2ppt</span>(<span class="at">x=</span>p<span class="sc">$</span>plot,</span>
<span id="cb205-14"><a href="可视化与建模.html#cb205-14" aria-hidden="true" tabindex="-1"></a>                  <span class="at">file=</span><span class="st">&quot;F:/wlzp/AD_KM/p.pptx&quot;</span>, <span class="at">width=</span><span class="dv">5</span>, <span class="at">height=</span><span class="dv">3</span>)</span></code></pre></div>
</div>
<div id="plotly" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Plotly</h2>
<div id="将ggplot对象转化为plotly对象" class="section level3" number="4.5.1">
<h3><span class="header-section-number">4.5.1</span> 将ggplot对象转化为plotly对象</h3>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="可视化与建模.html#cb206-1" aria-hidden="true" tabindex="-1"></a>iris <span class="sc">%&gt;%</span> </span>
<span id="cb206-2"><a href="可视化与建模.html#cb206-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length,<span class="at">y=</span>Sepal.Width,<span class="at">color=</span>Species)) <span class="sc">+</span></span>
<span id="cb206-3"><a href="可视化与建模.html#cb206-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="1003-chapter03-VisualizationModel_files/figure-html/unnamed-chunk-49-1.png" width="672" /></p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="可视化与建模.html#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb207-2"><a href="可视化与建模.html#cb207-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(iris <span class="sc">%&gt;%</span> </span>
<span id="cb207-3"><a href="可视化与建模.html#cb207-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length,<span class="at">y=</span>Sepal.Width,<span class="at">color=</span>Species)) <span class="sc">+</span></span>
<span id="cb207-4"><a href="可视化与建模.html#cb207-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>())</span></code></pre></div>
<div id="htmlwidget-1009e2f1795529c50273" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-1009e2f1795529c50273">{"x":{"data":[{"x":[5.1,4.9,4.7,4.6,5,5.4,4.6,5,4.4,4.9,5.4,4.8,4.8,4.3,5.8,5.7,5.4,5.1,5.7,5.1,5.4,5.1,4.6,5.1,4.8,5,5,5.2,5.2,4.7,4.8,5.4,5.2,5.5,4.9,5,5.5,4.9,4.4,5.1,5,4.5,4.4,5,5.1,4.8,5.1,4.6,5.3,5],"y":[3.5,3,3.2,3.1,3.6,3.9,3.4,3.4,2.9,3.1,3.7,3.4,3,3,4,4.4,3.9,3.5,3.8,3.8,3.4,3.7,3.6,3.3,3.4,3,3.4,3.5,3.4,3.2,3.1,3.4,4.1,4.2,3.1,3.2,3.5,3.6,3,3.4,3.5,2.3,3.2,3.5,3.8,3,3.8,3.2,3.7,3.3],"text":["Sepal.Length: 5.1<br />Sepal.Width: 3.5<br />Species: setosa","Sepal.Length: 4.9<br />Sepal.Width: 3.0<br />Species: setosa","Sepal.Length: 4.7<br />Sepal.Width: 3.2<br />Species: setosa","Sepal.Length: 4.6<br />Sepal.Width: 3.1<br />Species: setosa","Sepal.Length: 5.0<br />Sepal.Width: 3.6<br />Species: setosa","Sepal.Length: 5.4<br />Sepal.Width: 3.9<br />Species: setosa","Sepal.Length: 4.6<br />Sepal.Width: 3.4<br />Species: setosa","Sepal.Length: 5.0<br />Sepal.Width: 3.4<br />Species: setosa","Sepal.Length: 4.4<br />Sepal.Width: 2.9<br />Species: setosa","Sepal.Length: 4.9<br />Sepal.Width: 3.1<br />Species: setosa","Sepal.Length: 5.4<br />Sepal.Width: 3.7<br />Species: setosa","Sepal.Length: 4.8<br />Sepal.Width: 3.4<br />Species: setosa","Sepal.Length: 4.8<br />Sepal.Width: 3.0<br />Species: setosa","Sepal.Length: 4.3<br />Sepal.Width: 3.0<br />Species: setosa","Sepal.Length: 5.8<br />Sepal.Width: 4.0<br />Species: setosa","Sepal.Length: 5.7<br />Sepal.Width: 4.4<br />Species: setosa","Sepal.Length: 5.4<br />Sepal.Width: 3.9<br />Species: setosa","Sepal.Length: 5.1<br />Sepal.Width: 3.5<br />Species: setosa","Sepal.Length: 5.7<br />Sepal.Width: 3.8<br />Species: setosa","Sepal.Length: 5.1<br />Sepal.Width: 3.8<br />Species: setosa","Sepal.Length: 5.4<br />Sepal.Width: 3.4<br />Species: setosa","Sepal.Length: 5.1<br />Sepal.Width: 3.7<br />Species: setosa","Sepal.Length: 4.6<br />Sepal.Width: 3.6<br />Species: setosa","Sepal.Length: 5.1<br />Sepal.Width: 3.3<br />Species: setosa","Sepal.Length: 4.8<br />Sepal.Width: 3.4<br />Species: setosa","Sepal.Length: 5.0<br />Sepal.Width: 3.0<br />Species: setosa","Sepal.Length: 5.0<br />Sepal.Width: 3.4<br />Species: setosa","Sepal.Length: 5.2<br />Sepal.Width: 3.5<br />Species: setosa","Sepal.Length: 5.2<br />Sepal.Width: 3.4<br />Species: setosa","Sepal.Length: 4.7<br />Sepal.Width: 3.2<br />Species: setosa","Sepal.Length: 4.8<br />Sepal.Width: 3.1<br />Species: setosa","Sepal.Length: 5.4<br />Sepal.Width: 3.4<br />Species: setosa","Sepal.Length: 5.2<br />Sepal.Width: 4.1<br />Species: setosa","Sepal.Length: 5.5<br />Sepal.Width: 4.2<br />Species: setosa","Sepal.Length: 4.9<br />Sepal.Width: 3.1<br />Species: setosa","Sepal.Length: 5.0<br />Sepal.Width: 3.2<br />Species: setosa","Sepal.Length: 5.5<br />Sepal.Width: 3.5<br />Species: setosa","Sepal.Length: 4.9<br />Sepal.Width: 3.6<br />Species: setosa","Sepal.Length: 4.4<br />Sepal.Width: 3.0<br />Species: setosa","Sepal.Length: 5.1<br />Sepal.Width: 3.4<br />Species: setosa","Sepal.Length: 5.0<br />Sepal.Width: 3.5<br />Species: setosa","Sepal.Length: 4.5<br />Sepal.Width: 2.3<br />Species: setosa","Sepal.Length: 4.4<br />Sepal.Width: 3.2<br />Species: setosa","Sepal.Length: 5.0<br />Sepal.Width: 3.5<br />Species: setosa","Sepal.Length: 5.1<br />Sepal.Width: 3.8<br />Species: setosa","Sepal.Length: 4.8<br />Sepal.Width: 3.0<br />Species: setosa","Sepal.Length: 5.1<br />Sepal.Width: 3.8<br />Species: setosa","Sepal.Length: 4.6<br />Sepal.Width: 3.2<br />Species: setosa","Sepal.Length: 5.3<br />Sepal.Width: 3.7<br />Species: setosa","Sepal.Length: 5.0<br />Sepal.Width: 3.3<br />Species: setosa"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(248,118,109,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(248,118,109,1)"}},"hoveron":"points","name":"setosa","legendgroup":"setosa","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[7,6.4,6.9,5.5,6.5,5.7,6.3,4.9,6.6,5.2,5,5.9,6,6.1,5.6,6.7,5.6,5.8,6.2,5.6,5.9,6.1,6.3,6.1,6.4,6.6,6.8,6.7,6,5.7,5.5,5.5,5.8,6,5.4,6,6.7,6.3,5.6,5.5,5.5,6.1,5.8,5,5.6,5.7,5.7,6.2,5.1,5.7],"y":[3.2,3.2,3.1,2.3,2.8,2.8,3.3,2.4,2.9,2.7,2,3,2.2,2.9,2.9,3.1,3,2.7,2.2,2.5,3.2,2.8,2.5,2.8,2.9,3,2.8,3,2.9,2.6,2.4,2.4,2.7,2.7,3,3.4,3.1,2.3,3,2.5,2.6,3,2.6,2.3,2.7,3,2.9,2.9,2.5,2.8],"text":["Sepal.Length: 7.0<br />Sepal.Width: 3.2<br />Species: versicolor","Sepal.Length: 6.4<br />Sepal.Width: 3.2<br />Species: versicolor","Sepal.Length: 6.9<br />Sepal.Width: 3.1<br />Species: versicolor","Sepal.Length: 5.5<br />Sepal.Width: 2.3<br />Species: versicolor","Sepal.Length: 6.5<br />Sepal.Width: 2.8<br />Species: versicolor","Sepal.Length: 5.7<br />Sepal.Width: 2.8<br />Species: versicolor","Sepal.Length: 6.3<br />Sepal.Width: 3.3<br />Species: versicolor","Sepal.Length: 4.9<br />Sepal.Width: 2.4<br />Species: versicolor","Sepal.Length: 6.6<br />Sepal.Width: 2.9<br />Species: versicolor","Sepal.Length: 5.2<br />Sepal.Width: 2.7<br />Species: versicolor","Sepal.Length: 5.0<br />Sepal.Width: 2.0<br />Species: versicolor","Sepal.Length: 5.9<br />Sepal.Width: 3.0<br />Species: versicolor","Sepal.Length: 6.0<br />Sepal.Width: 2.2<br />Species: versicolor","Sepal.Length: 6.1<br />Sepal.Width: 2.9<br />Species: versicolor","Sepal.Length: 5.6<br />Sepal.Width: 2.9<br />Species: versicolor","Sepal.Length: 6.7<br />Sepal.Width: 3.1<br />Species: versicolor","Sepal.Length: 5.6<br />Sepal.Width: 3.0<br />Species: versicolor","Sepal.Length: 5.8<br />Sepal.Width: 2.7<br />Species: versicolor","Sepal.Length: 6.2<br />Sepal.Width: 2.2<br />Species: versicolor","Sepal.Length: 5.6<br />Sepal.Width: 2.5<br />Species: versicolor","Sepal.Length: 5.9<br />Sepal.Width: 3.2<br />Species: versicolor","Sepal.Length: 6.1<br />Sepal.Width: 2.8<br />Species: versicolor","Sepal.Length: 6.3<br />Sepal.Width: 2.5<br />Species: versicolor","Sepal.Length: 6.1<br />Sepal.Width: 2.8<br />Species: versicolor","Sepal.Length: 6.4<br />Sepal.Width: 2.9<br />Species: versicolor","Sepal.Length: 6.6<br />Sepal.Width: 3.0<br />Species: versicolor","Sepal.Length: 6.8<br />Sepal.Width: 2.8<br />Species: versicolor","Sepal.Length: 6.7<br />Sepal.Width: 3.0<br />Species: versicolor","Sepal.Length: 6.0<br />Sepal.Width: 2.9<br />Species: versicolor","Sepal.Length: 5.7<br />Sepal.Width: 2.6<br />Species: versicolor","Sepal.Length: 5.5<br />Sepal.Width: 2.4<br />Species: versicolor","Sepal.Length: 5.5<br />Sepal.Width: 2.4<br />Species: versicolor","Sepal.Length: 5.8<br />Sepal.Width: 2.7<br />Species: versicolor","Sepal.Length: 6.0<br />Sepal.Width: 2.7<br />Species: versicolor","Sepal.Length: 5.4<br />Sepal.Width: 3.0<br />Species: versicolor","Sepal.Length: 6.0<br />Sepal.Width: 3.4<br />Species: versicolor","Sepal.Length: 6.7<br />Sepal.Width: 3.1<br />Species: versicolor","Sepal.Length: 6.3<br />Sepal.Width: 2.3<br />Species: versicolor","Sepal.Length: 5.6<br />Sepal.Width: 3.0<br />Species: versicolor","Sepal.Length: 5.5<br />Sepal.Width: 2.5<br />Species: versicolor","Sepal.Length: 5.5<br />Sepal.Width: 2.6<br />Species: versicolor","Sepal.Length: 6.1<br />Sepal.Width: 3.0<br />Species: versicolor","Sepal.Length: 5.8<br />Sepal.Width: 2.6<br />Species: versicolor","Sepal.Length: 5.0<br />Sepal.Width: 2.3<br />Species: versicolor","Sepal.Length: 5.6<br />Sepal.Width: 2.7<br />Species: versicolor","Sepal.Length: 5.7<br />Sepal.Width: 3.0<br />Species: versicolor","Sepal.Length: 5.7<br />Sepal.Width: 2.9<br />Species: versicolor","Sepal.Length: 6.2<br />Sepal.Width: 2.9<br />Species: versicolor","Sepal.Length: 5.1<br />Sepal.Width: 2.5<br />Species: versicolor","Sepal.Length: 5.7<br />Sepal.Width: 2.8<br />Species: versicolor"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(0,186,56,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(0,186,56,1)"}},"hoveron":"points","name":"versicolor","legendgroup":"versicolor","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[6.3,5.8,7.1,6.3,6.5,7.6,4.9,7.3,6.7,7.2,6.5,6.4,6.8,5.7,5.8,6.4,6.5,7.7,7.7,6,6.9,5.6,7.7,6.3,6.7,7.2,6.2,6.1,6.4,7.2,7.4,7.9,6.4,6.3,6.1,7.7,6.3,6.4,6,6.9,6.7,6.9,5.8,6.8,6.7,6.7,6.3,6.5,6.2,5.9],"y":[3.3,2.7,3,2.9,3,3,2.5,2.9,2.5,3.6,3.2,2.7,3,2.5,2.8,3.2,3,3.8,2.6,2.2,3.2,2.8,2.8,2.7,3.3,3.2,2.8,3,2.8,3,2.8,3.8,2.8,2.8,2.6,3,3.4,3.1,3,3.1,3.1,3.1,2.7,3.2,3.3,3,2.5,3,3.4,3],"text":["Sepal.Length: 6.3<br />Sepal.Width: 3.3<br />Species: virginica","Sepal.Length: 5.8<br />Sepal.Width: 2.7<br />Species: virginica","Sepal.Length: 7.1<br />Sepal.Width: 3.0<br />Species: virginica","Sepal.Length: 6.3<br />Sepal.Width: 2.9<br />Species: virginica","Sepal.Length: 6.5<br />Sepal.Width: 3.0<br />Species: virginica","Sepal.Length: 7.6<br />Sepal.Width: 3.0<br />Species: virginica","Sepal.Length: 4.9<br />Sepal.Width: 2.5<br />Species: virginica","Sepal.Length: 7.3<br />Sepal.Width: 2.9<br />Species: virginica","Sepal.Length: 6.7<br />Sepal.Width: 2.5<br />Species: virginica","Sepal.Length: 7.2<br />Sepal.Width: 3.6<br />Species: virginica","Sepal.Length: 6.5<br />Sepal.Width: 3.2<br />Species: virginica","Sepal.Length: 6.4<br />Sepal.Width: 2.7<br />Species: virginica","Sepal.Length: 6.8<br />Sepal.Width: 3.0<br />Species: virginica","Sepal.Length: 5.7<br />Sepal.Width: 2.5<br />Species: virginica","Sepal.Length: 5.8<br />Sepal.Width: 2.8<br />Species: virginica","Sepal.Length: 6.4<br />Sepal.Width: 3.2<br />Species: virginica","Sepal.Length: 6.5<br />Sepal.Width: 3.0<br />Species: virginica","Sepal.Length: 7.7<br />Sepal.Width: 3.8<br />Species: virginica","Sepal.Length: 7.7<br />Sepal.Width: 2.6<br />Species: virginica","Sepal.Length: 6.0<br />Sepal.Width: 2.2<br />Species: virginica","Sepal.Length: 6.9<br />Sepal.Width: 3.2<br />Species: virginica","Sepal.Length: 5.6<br />Sepal.Width: 2.8<br />Species: virginica","Sepal.Length: 7.7<br />Sepal.Width: 2.8<br />Species: virginica","Sepal.Length: 6.3<br />Sepal.Width: 2.7<br />Species: virginica","Sepal.Length: 6.7<br />Sepal.Width: 3.3<br />Species: virginica","Sepal.Length: 7.2<br />Sepal.Width: 3.2<br />Species: virginica","Sepal.Length: 6.2<br />Sepal.Width: 2.8<br />Species: virginica","Sepal.Length: 6.1<br />Sepal.Width: 3.0<br />Species: virginica","Sepal.Length: 6.4<br />Sepal.Width: 2.8<br />Species: virginica","Sepal.Length: 7.2<br />Sepal.Width: 3.0<br />Species: virginica","Sepal.Length: 7.4<br />Sepal.Width: 2.8<br />Species: virginica","Sepal.Length: 7.9<br />Sepal.Width: 3.8<br />Species: virginica","Sepal.Length: 6.4<br />Sepal.Width: 2.8<br />Species: virginica","Sepal.Length: 6.3<br />Sepal.Width: 2.8<br />Species: virginica","Sepal.Length: 6.1<br />Sepal.Width: 2.6<br />Species: virginica","Sepal.Length: 7.7<br />Sepal.Width: 3.0<br />Species: virginica","Sepal.Length: 6.3<br />Sepal.Width: 3.4<br />Species: virginica","Sepal.Length: 6.4<br />Sepal.Width: 3.1<br />Species: virginica","Sepal.Length: 6.0<br />Sepal.Width: 3.0<br />Species: virginica","Sepal.Length: 6.9<br />Sepal.Width: 3.1<br />Species: virginica","Sepal.Length: 6.7<br />Sepal.Width: 3.1<br />Species: virginica","Sepal.Length: 6.9<br />Sepal.Width: 3.1<br />Species: virginica","Sepal.Length: 5.8<br />Sepal.Width: 2.7<br />Species: virginica","Sepal.Length: 6.8<br />Sepal.Width: 3.2<br />Species: virginica","Sepal.Length: 6.7<br />Sepal.Width: 3.3<br />Species: virginica","Sepal.Length: 6.7<br />Sepal.Width: 3.0<br />Species: virginica","Sepal.Length: 6.3<br />Sepal.Width: 2.5<br />Species: virginica","Sepal.Length: 6.5<br />Sepal.Width: 3.0<br />Species: virginica","Sepal.Length: 6.2<br />Sepal.Width: 3.4<br />Species: virginica","Sepal.Length: 5.9<br />Sepal.Width: 3.0<br />Species: virginica"],"type":"scatter","mode":"markers","marker":{"autocolorscale":false,"color":"rgba(97,156,255,1)","opacity":1,"size":5.66929133858268,"symbol":"circle","line":{"width":1.88976377952756,"color":"rgba(97,156,255,1)"}},"hoveron":"points","name":"virginica","legendgroup":"virginica","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":43.1050228310502},"plot_bgcolor":"rgba(235,235,235,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[4.12,8.08],"tickmode":"array","ticktext":["5","6","7","8"],"tickvals":[5,6,7,8],"categoryorder":"array","categoryarray":["5","6","7","8"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"y","title":{"text":"Sepal.Length","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[1.88,4.52],"tickmode":"array","ticktext":["2.0","2.5","3.0","3.5","4.0","4.5"],"tickvals":[2,2.5,3,3.5,4,4.5],"categoryorder":"array","categoryarray":["2.0","2.5","3.0","3.5","4.0","4.5"],"nticks":null,"ticks":"outside","tickcolor":"rgba(51,51,51,1)","ticklen":3.65296803652968,"tickwidth":0.66417600664176,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(255,255,255,1)","gridwidth":0.66417600664176,"zeroline":false,"anchor":"x","title":{"text":"Sepal.Width","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":null,"line":{"color":null,"width":0,"linetype":[]},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.96751968503937},"annotations":[{"text":"Species","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"47148eb9ed":{"x":{},"y":{},"colour":{},"type":"scatter"}},"cur_data":"47148eb9ed","visdat":{"47148eb9ed":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="可视化与建模.html#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb208-2"><a href="可视化与建模.html#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survminer)</span>
<span id="cb208-3"><a href="可视化与建模.html#cb208-3" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(time, status) <span class="sc">~</span> sex, <span class="at">data =</span> lung)</span>
<span id="cb208-4"><a href="可视化与建模.html#cb208-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggsurvplot</span>(</span>
<span id="cb208-5"><a href="可视化与建模.html#cb208-5" aria-hidden="true" tabindex="-1"></a>   fit,                     <span class="co"># survfit object with calculated statistics.</span></span>
<span id="cb208-6"><a href="可视化与建模.html#cb208-6" aria-hidden="true" tabindex="-1"></a>   <span class="at">data =</span> lung,             <span class="co"># data used to fit survival curves.</span></span>
<span id="cb208-7"><a href="可视化与建模.html#cb208-7" aria-hidden="true" tabindex="-1"></a>   <span class="at">risk.table =</span> <span class="cn">FALSE</span>,       <span class="co"># show risk table.</span></span>
<span id="cb208-8"><a href="可视化与建模.html#cb208-8" aria-hidden="true" tabindex="-1"></a>   <span class="at">pval =</span> <span class="cn">FALSE</span>,             <span class="co"># show p-value of log-rank test.</span></span>
<span id="cb208-9"><a href="可视化与建模.html#cb208-9" aria-hidden="true" tabindex="-1"></a>   <span class="at">censor=</span><span class="cn">FALSE</span>,</span>
<span id="cb208-10"><a href="可视化与建模.html#cb208-10" aria-hidden="true" tabindex="-1"></a>   <span class="at">conf.int =</span> <span class="cn">TRUE</span>,         <span class="co"># show confidence intervals for </span></span>
<span id="cb208-11"><a href="可视化与建模.html#cb208-11" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># point estimates of survival curves.</span></span>
<span id="cb208-12"><a href="可视化与建模.html#cb208-12" aria-hidden="true" tabindex="-1"></a>   <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1000</span>),         <span class="co"># present narrower X axis, but not affect</span></span>
<span id="cb208-13"><a href="可视化与建模.html#cb208-13" aria-hidden="true" tabindex="-1"></a>                            <span class="co"># survival estimates.</span></span>
<span id="cb208-14"><a href="可视化与建模.html#cb208-14" aria-hidden="true" tabindex="-1"></a>   <span class="at">xlab =</span> <span class="st">&quot;Time in days&quot;</span>,   <span class="co"># customize X axis label.</span></span>
<span id="cb208-15"><a href="可视化与建模.html#cb208-15" aria-hidden="true" tabindex="-1"></a>   <span class="at">break.time.by =</span> <span class="dv">100</span>,     <span class="co"># break X axis in time intervals by 500.</span></span>
<span id="cb208-16"><a href="可视化与建模.html#cb208-16" aria-hidden="true" tabindex="-1"></a>   <span class="at">ggtheme =</span> <span class="fu">theme_light</span>(), <span class="co"># customize plot and risk table with a theme.</span></span>
<span id="cb208-17"><a href="可视化与建模.html#cb208-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb208-18"><a href="可视化与建模.html#cb208-18" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplotly</span>(p<span class="sc">$</span>plot)</span></code></pre></div>
<div id="htmlwidget-ff6c87c1dc35dc78a508" style="width:672px;height:480px;" class="plotly html-widget"></div>
<script type="application/json" data-for="htmlwidget-ff6c87c1dc35dc78a508">{"x":{"data":[{"x":[0,11,12,13,15,26,30,31,53,54,59,60,65,71,81,88,92,93,95,105,107,110,116,118,131,132,135,142,144,147,156,163,166,170,174,175,176,177,179,180,181,183,185,188,189,191,196,197,202,207,210,212,218,221,222,223,225,229,230,237,239,246,259,267,269,270,279,283,284,285,286,288,291,292,300,301,303,306,310,320,329,337,353,363,364,371,387,390,394,404,413,428,429,442,444,455,457,458,460,477,519,524,533,558,567,574,583,613,624,643,655,689,707,791,806,814,840,883,1010,1022],"y":[1,0.978260869565217,0.971014492753623,0.956521739130435,0.94927536231884,0.942028985507246,0.934782608695652,0.927536231884058,0.91304347826087,0.905797101449275,0.898550724637681,0.891304347826087,0.876811594202899,0.869565217391304,0.86231884057971,0.847826086956522,0.840579710144928,0.833333333333334,0.826086956521739,0.818840579710145,0.811594202898551,0.804347826086957,0.797101449275363,0.789855072463768,0.782608695652174,0.768115942028986,0.760869565217392,0.753623188405797,0.746376811594203,0.739130434782609,0.724637681159421,0.702898550724638,0.695652173913044,0.68840579710145,0.68840579710145,0.681082331174838,0.673758865248227,0.666435399321616,0.651788467468394,0.644465001541783,0.62981806968856,0.622494603761949,0.622494603761949,0.622494603761949,0.614994668776865,0.614994668776865,0.614994668776865,0.607307235417155,0.599521245219499,0.591735255021843,0.583949264824187,0.576163274626531,0.568377284428876,0.568377284428876,0.560483155478475,0.552476253257354,0.552476253257354,0.544230339029632,0.53598442480191,0.53598442480191,0.52760966816438,0.519234911526851,0.519234911526851,0.510722863796902,0.502210816066954,0.493698768337005,0.493698768337005,0.485037386436356,0.476376004535707,0.467554226673935,0.458732448812162,0.44991067095039,0.441088893088618,0.441088893088618,0.441088893088618,0.431899541149271,0.422510420689505,0.41290791112838,0.403305401567254,0.393702892006129,0.384100382445004,0.374497872883879,0.355292853761629,0.345690344200504,0.336087834639379,0.326485325078254,0.316882815517128,0.307280305956003,0.297677796394878,0.297677796394878,0.297677796394878,0.287413044795055,0.277148293195231,0.266883541595408,0.266883541595408,0.256208199931592,0.245532858267775,0.245532858267775,0.234372273801058,0.223211689334341,0.212051104867624,0.200890520400907,0.18972993593419,0.178569351467473,0.167408767000756,0.156248182534039,0.145087598067322,0.133927013600605,0.122766429133888,0.111605844667171,0.100445260200454,0.0892846757337365,0.0781240912670194,0.0669635068003024,0.0669635068003024,0.0535708054402419,0.0535708054402419,0.0357138702934946,0.0357138702934946,0.0357138702934946],"text":["time:    0<br />surv: 1.00000000<br />strata: sex=1","time:   11<br />surv: 0.97826087<br />strata: sex=1","time:   12<br />surv: 0.97101449<br />strata: sex=1","time:   13<br />surv: 0.95652174<br />strata: sex=1","time:   15<br />surv: 0.94927536<br />strata: sex=1","time:   26<br />surv: 0.94202899<br />strata: sex=1","time:   30<br />surv: 0.93478261<br />strata: sex=1","time:   31<br />surv: 0.92753623<br />strata: sex=1","time:   53<br />surv: 0.91304348<br />strata: sex=1","time:   54<br />surv: 0.90579710<br />strata: sex=1","time:   59<br />surv: 0.89855072<br />strata: sex=1","time:   60<br />surv: 0.89130435<br />strata: sex=1","time:   65<br />surv: 0.87681159<br />strata: sex=1","time:   71<br />surv: 0.86956522<br />strata: sex=1","time:   81<br />surv: 0.86231884<br />strata: sex=1","time:   88<br />surv: 0.84782609<br />strata: sex=1","time:   92<br />surv: 0.84057971<br />strata: sex=1","time:   93<br />surv: 0.83333333<br />strata: sex=1","time:   95<br />surv: 0.82608696<br />strata: sex=1","time:  105<br />surv: 0.81884058<br />strata: sex=1","time:  107<br />surv: 0.81159420<br />strata: sex=1","time:  110<br />surv: 0.80434783<br />strata: sex=1","time:  116<br />surv: 0.79710145<br />strata: sex=1","time:  118<br />surv: 0.78985507<br />strata: sex=1","time:  131<br />surv: 0.78260870<br />strata: sex=1","time:  132<br />surv: 0.76811594<br />strata: sex=1","time:  135<br />surv: 0.76086957<br />strata: sex=1","time:  142<br />surv: 0.75362319<br />strata: sex=1","time:  144<br />surv: 0.74637681<br />strata: sex=1","time:  147<br />surv: 0.73913043<br />strata: sex=1","time:  156<br />surv: 0.72463768<br />strata: sex=1","time:  163<br />surv: 0.70289855<br />strata: sex=1","time:  166<br />surv: 0.69565217<br />strata: sex=1","time:  170<br />surv: 0.68840580<br />strata: sex=1","time:  174<br />surv: 0.68840580<br />strata: sex=1","time:  175<br />surv: 0.68108233<br />strata: sex=1","time:  176<br />surv: 0.67375887<br />strata: sex=1","time:  177<br />surv: 0.66643540<br />strata: sex=1","time:  179<br />surv: 0.65178847<br />strata: sex=1","time:  180<br />surv: 0.64446500<br />strata: sex=1","time:  181<br />surv: 0.62981807<br />strata: sex=1","time:  183<br />surv: 0.62249460<br />strata: sex=1","time:  185<br />surv: 0.62249460<br />strata: sex=1","time:  188<br />surv: 0.62249460<br />strata: sex=1","time:  189<br />surv: 0.61499467<br />strata: sex=1","time:  191<br />surv: 0.61499467<br />strata: sex=1","time:  196<br />surv: 0.61499467<br />strata: sex=1","time:  197<br />surv: 0.60730724<br />strata: sex=1","time:  202<br />surv: 0.59952125<br />strata: sex=1","time:  207<br />surv: 0.59173526<br />strata: sex=1","time:  210<br />surv: 0.58394926<br />strata: sex=1","time:  212<br />surv: 0.57616327<br />strata: sex=1","time:  218<br />surv: 0.56837728<br />strata: sex=1","time:  221<br />surv: 0.56837728<br />strata: sex=1","time:  222<br />surv: 0.56048316<br />strata: sex=1","time:  223<br />surv: 0.55247625<br />strata: sex=1","time:  225<br />surv: 0.55247625<br />strata: sex=1","time:  229<br />surv: 0.54423034<br />strata: sex=1","time:  230<br />surv: 0.53598442<br />strata: sex=1","time:  237<br />surv: 0.53598442<br />strata: sex=1","time:  239<br />surv: 0.52760967<br />strata: sex=1","time:  246<br />surv: 0.51923491<br />strata: sex=1","time:  259<br />surv: 0.51923491<br />strata: sex=1","time:  267<br />surv: 0.51072286<br />strata: sex=1","time:  269<br />surv: 0.50221082<br />strata: sex=1","time:  270<br />surv: 0.49369877<br />strata: sex=1","time:  279<br />surv: 0.49369877<br />strata: sex=1","time:  283<br />surv: 0.48503739<br />strata: sex=1","time:  284<br />surv: 0.47637600<br />strata: sex=1","time:  285<br />surv: 0.46755423<br />strata: sex=1","time:  286<br />surv: 0.45873245<br />strata: sex=1","time:  288<br />surv: 0.44991067<br />strata: sex=1","time:  291<br />surv: 0.44108889<br />strata: sex=1","time:  292<br />surv: 0.44108889<br />strata: sex=1","time:  300<br />surv: 0.44108889<br />strata: sex=1","time:  301<br />surv: 0.43189954<br />strata: sex=1","time:  303<br />surv: 0.42251042<br />strata: sex=1","time:  306<br />surv: 0.41290791<br />strata: sex=1","time:  310<br />surv: 0.40330540<br />strata: sex=1","time:  320<br />surv: 0.39370289<br />strata: sex=1","time:  329<br />surv: 0.38410038<br />strata: sex=1","time:  337<br />surv: 0.37449787<br />strata: sex=1","time:  353<br />surv: 0.35529285<br />strata: sex=1","time:  363<br />surv: 0.34569034<br />strata: sex=1","time:  364<br />surv: 0.33608783<br />strata: sex=1","time:  371<br />surv: 0.32648533<br />strata: sex=1","time:  387<br />surv: 0.31688282<br />strata: sex=1","time:  390<br />surv: 0.30728031<br />strata: sex=1","time:  394<br />surv: 0.29767780<br />strata: sex=1","time:  404<br />surv: 0.29767780<br />strata: sex=1","time:  413<br />surv: 0.29767780<br />strata: sex=1","time:  428<br />surv: 0.28741304<br />strata: sex=1","time:  429<br />surv: 0.27714829<br />strata: sex=1","time:  442<br />surv: 0.26688354<br />strata: sex=1","time:  444<br />surv: 0.26688354<br />strata: sex=1","time:  455<br />surv: 0.25620820<br />strata: sex=1","time:  457<br />surv: 0.24553286<br />strata: sex=1","time:  458<br />surv: 0.24553286<br />strata: sex=1","time:  460<br />surv: 0.23437227<br />strata: sex=1","time:  477<br />surv: 0.22321169<br />strata: sex=1","time:  519<br />surv: 0.21205110<br />strata: sex=1","time:  524<br />surv: 0.20089052<br />strata: sex=1","time:  533<br />surv: 0.18972994<br />strata: sex=1","time:  558<br />surv: 0.17856935<br />strata: sex=1","time:  567<br />surv: 0.16740877<br />strata: sex=1","time:  574<br />surv: 0.15624818<br />strata: sex=1","time:  583<br />surv: 0.14508760<br />strata: sex=1","time:  613<br />surv: 0.13392701<br />strata: sex=1","time:  624<br />surv: 0.12276643<br />strata: sex=1","time:  643<br />surv: 0.11160584<br />strata: sex=1","time:  655<br />surv: 0.10044526<br />strata: sex=1","time:  689<br />surv: 0.08928468<br />strata: sex=1","time:  707<br />surv: 0.07812409<br />strata: sex=1","time:  791<br />surv: 0.06696351<br />strata: sex=1","time:  806<br />surv: 0.06696351<br />strata: sex=1","time:  814<br />surv: 0.05357081<br />strata: sex=1","time:  840<br />surv: 0.05357081<br />strata: sex=1","time:  883<br />surv: 0.03571387<br />strata: sex=1","time: 1010<br />surv: 0.03571387<br />strata: sex=1","time: 1022<br />surv: 0.03571387<br />strata: sex=1"],"type":"scatter","mode":"lines","line":{"width":3.77952755905512,"color":"rgba(248,118,109,1)","dash":"solid","shape":"hv"},"hoveron":"points","name":"(sex=1,1)","legendgroup":"(sex=1,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"x":[0,5,60,61,62,79,81,92,95,105,107,122,145,153,166,167,173,175,177,182,186,192,194,199,201,202,203,208,211,224,226,235,239,240,243,245,252,266,268,269,272,276,285,292,293,296,305,310,315,332,340,345,348,350,351,356,361,363,364,371,376,382,384,426,433,444,450,473,511,520,524,529,543,550,551,559,588,641,654,687,705,728,731,735,740,765,821,965],"y":[1,0.988888888888889,0.977777777777778,0.966666666666667,0.955555555555556,0.944444444444444,0.933333333333333,0.933333333333333,0.922088353413655,0.922088353413655,0.910704546581387,0.89932073974912,0.876553126084585,0.865169319252318,0.853785512420051,0.842401705587783,0.842401705587783,0.842401705587783,0.842401705587783,0.830536892833026,0.818672080078268,0.818672080078268,0.806632784783,0.794593489487731,0.770514898897194,0.770514898897194,0.770514898897194,0.758087239237561,0.758087239237561,0.758087239237561,0.745238302979298,0.745238302979298,0.732163946786679,0.732163946786679,0.732163946786679,0.718605355179518,0.718605355179518,0.718605355179518,0.704515054097567,0.704515054097567,0.704515054097567,0.704515054097567,0.689525372095491,0.689525372095491,0.674202586048924,0.674202586048924,0.65852345614081,0.642844326232695,0.642844326232695,0.642844326232695,0.626361138380575,0.609877950528454,0.593394762676334,0.576911574824214,0.560428386972093,0.560428386972093,0.543445708578999,0.526463030185906,0.526463030185906,0.508914262513042,0.508914262513042,0.508914262513042,0.508914262513042,0.489340637031771,0.4697670115505,0.45019338606923,0.430619760587959,0.411046135106688,0.411046135106688,0.38941212799581,0.367778120884931,0.367778120884931,0.367778120884931,0.343259579492602,0.343259579492602,0.343259579492602,0.343259579492602,0.312054163175093,0.280848746857584,0.249643330540075,0.218437914222565,0.187232497905056,0.156027081587547,0.124821665270037,0.124821665270037,0.0832144435133582,0.0832144435133582,0.0832144435133582],"text":["time:    0<br />surv: 1.00000000<br />strata: sex=2","time:    5<br />surv: 0.98888889<br />strata: sex=2","time:   60<br />surv: 0.97777778<br />strata: sex=2","time:   61<br />surv: 0.96666667<br />strata: sex=2","time:   62<br />surv: 0.95555556<br />strata: sex=2","time:   79<br />surv: 0.94444444<br />strata: sex=2","time:   81<br />surv: 0.93333333<br />strata: sex=2","time:   92<br />surv: 0.93333333<br />strata: sex=2","time:   95<br />surv: 0.92208835<br />strata: sex=2","time:  105<br />surv: 0.92208835<br />strata: sex=2","time:  107<br />surv: 0.91070455<br />strata: sex=2","time:  122<br />surv: 0.89932074<br />strata: sex=2","time:  145<br />surv: 0.87655313<br />strata: sex=2","time:  153<br />surv: 0.86516932<br />strata: sex=2","time:  166<br />surv: 0.85378551<br />strata: sex=2","time:  167<br />surv: 0.84240171<br />strata: sex=2","time:  173<br />surv: 0.84240171<br />strata: sex=2","time:  175<br />surv: 0.84240171<br />strata: sex=2","time:  177<br />surv: 0.84240171<br />strata: sex=2","time:  182<br />surv: 0.83053689<br />strata: sex=2","time:  186<br />surv: 0.81867208<br />strata: sex=2","time:  192<br />surv: 0.81867208<br />strata: sex=2","time:  194<br />surv: 0.80663278<br />strata: sex=2","time:  199<br />surv: 0.79459349<br />strata: sex=2","time:  201<br />surv: 0.77051490<br />strata: sex=2","time:  202<br />surv: 0.77051490<br />strata: sex=2","time:  203<br />surv: 0.77051490<br />strata: sex=2","time:  208<br />surv: 0.75808724<br />strata: sex=2","time:  211<br />surv: 0.75808724<br />strata: sex=2","time:  224<br />surv: 0.75808724<br />strata: sex=2","time:  226<br />surv: 0.74523830<br />strata: sex=2","time:  235<br />surv: 0.74523830<br />strata: sex=2","time:  239<br />surv: 0.73216395<br />strata: sex=2","time:  240<br />surv: 0.73216395<br />strata: sex=2","time:  243<br />surv: 0.73216395<br />strata: sex=2","time:  245<br />surv: 0.71860536<br />strata: sex=2","time:  252<br />surv: 0.71860536<br />strata: sex=2","time:  266<br />surv: 0.71860536<br />strata: sex=2","time:  268<br />surv: 0.70451505<br />strata: sex=2","time:  269<br />surv: 0.70451505<br />strata: sex=2","time:  272<br />surv: 0.70451505<br />strata: sex=2","time:  276<br />surv: 0.70451505<br />strata: sex=2","time:  285<br />surv: 0.68952537<br />strata: sex=2","time:  292<br />surv: 0.68952537<br />strata: sex=2","time:  293<br />surv: 0.67420259<br />strata: sex=2","time:  296<br />surv: 0.67420259<br />strata: sex=2","time:  305<br />surv: 0.65852346<br />strata: sex=2","time:  310<br />surv: 0.64284433<br />strata: sex=2","time:  315<br />surv: 0.64284433<br />strata: sex=2","time:  332<br />surv: 0.64284433<br />strata: sex=2","time:  340<br />surv: 0.62636114<br />strata: sex=2","time:  345<br />surv: 0.60987795<br />strata: sex=2","time:  348<br />surv: 0.59339476<br />strata: sex=2","time:  350<br />surv: 0.57691157<br />strata: sex=2","time:  351<br />surv: 0.56042839<br />strata: sex=2","time:  356<br />surv: 0.56042839<br />strata: sex=2","time:  361<br />surv: 0.54344571<br />strata: sex=2","time:  363<br />surv: 0.52646303<br />strata: sex=2","time:  364<br />surv: 0.52646303<br />strata: sex=2","time:  371<br />surv: 0.50891426<br />strata: sex=2","time:  376<br />surv: 0.50891426<br />strata: sex=2","time:  382<br />surv: 0.50891426<br />strata: sex=2","time:  384<br />surv: 0.50891426<br />strata: sex=2","time:  426<br />surv: 0.48934064<br />strata: sex=2","time:  433<br />surv: 0.46976701<br />strata: sex=2","time:  444<br />surv: 0.45019339<br />strata: sex=2","time:  450<br />surv: 0.43061976<br />strata: sex=2","time:  473<br />surv: 0.41104614<br />strata: sex=2","time:  511<br />surv: 0.41104614<br />strata: sex=2","time:  520<br />surv: 0.38941213<br />strata: sex=2","time:  524<br />surv: 0.36777812<br />strata: sex=2","time:  529<br />surv: 0.36777812<br />strata: sex=2","time:  543<br />surv: 0.36777812<br />strata: sex=2","time:  550<br />surv: 0.34325958<br />strata: sex=2","time:  551<br />surv: 0.34325958<br />strata: sex=2","time:  559<br />surv: 0.34325958<br />strata: sex=2","time:  588<br />surv: 0.34325958<br />strata: sex=2","time:  641<br />surv: 0.31205416<br />strata: sex=2","time:  654<br />surv: 0.28084875<br />strata: sex=2","time:  687<br />surv: 0.24964333<br />strata: sex=2","time:  705<br />surv: 0.21843791<br />strata: sex=2","time:  728<br />surv: 0.18723250<br />strata: sex=2","time:  731<br />surv: 0.15602708<br />strata: sex=2","time:  735<br />surv: 0.12482167<br />strata: sex=2","time:  740<br />surv: 0.12482167<br />strata: sex=2","time:  765<br />surv: 0.08321444<br />strata: sex=2","time:  821<br />surv: 0.08321444<br />strata: sex=2","time:  965<br />surv: 0.08321444<br />strata: sex=2"],"type":"scatter","mode":"lines","line":{"width":3.77952755905512,"color":"rgba(0,191,196,1)","dash":"solid","shape":"hv"},"hoveron":"points","name":"(sex=2,1)","legendgroup":"(sex=2,1)","showlegend":true,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"visible":false,"showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"name":"(sex=1,1)","legendgroup":"(sex=1,1)","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null},{"name":"(sex=2,1)","legendgroup":"(sex=2,1)","showlegend":false,"xaxis":"x","yaxis":"y","hoverinfo":"text","frame":null}],"layout":{"margin":{"t":26.2283105022831,"r":7.30593607305936,"b":40.1826484018265,"l":48.9497716894977},"plot_bgcolor":"rgba(255,255,255,1)","paper_bgcolor":"rgba(255,255,255,1)","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-50,1050],"tickmode":"array","ticktext":[0,100,200,300,400,500,600,700,800,900,1000],"tickvals":[0,100,200,300,400,500,600,700,800,900,1000],"categoryorder":"array","categoryarray":[0,100,200,300,400,500,600,700,800,900,1000],"nticks":null,"ticks":"outside","tickcolor":"rgba(0,0,0,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"y","title":{"text":"Time in days","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"yaxis":{"domain":[0,1],"automargin":true,"type":"linear","autorange":false,"range":[-0.05,1.05],"tickmode":"array","ticktext":["0.00","0.25","0.50","0.75","1.00"],"tickvals":[0,0.25,0.5,0.75,1],"categoryorder":"array","categoryarray":["0.00","0.25","0.50","0.75","1.00"],"nticks":null,"ticks":"outside","tickcolor":"rgba(0,0,0,1)","ticklen":3.65296803652968,"tickwidth":0.33208800332088,"showticklabels":true,"tickfont":{"color":"rgba(77,77,77,1)","family":"","size":11.689497716895},"tickangle":-0,"showline":false,"linecolor":null,"linewidth":0,"showgrid":true,"gridcolor":"rgba(222,222,222,1)","gridwidth":0.33208800332088,"zeroline":false,"anchor":"x","title":{"text":"Survival probability","font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187}},"hoverformat":".2f"},"shapes":[{"type":"rect","fillcolor":"transparent","line":{"color":"rgba(179,179,179,1)","width":0.66417600664176,"linetype":"solid"},"yref":"paper","xref":"paper","x0":0,"x1":1,"y0":0,"y1":1}],"showlegend":true,"legend":{"bgcolor":"rgba(255,255,255,1)","bordercolor":"transparent","borderwidth":1.88976377952756,"font":{"color":"rgba(0,0,0,1)","family":"","size":11.689497716895},"y":0.96751968503937},"annotations":[{"text":"Strata","x":1.02,"y":1,"showarrow":false,"ax":0,"ay":0,"font":{"color":"rgba(0,0,0,1)","family":"","size":14.6118721461187},"xref":"paper","yref":"paper","textangle":-0,"xanchor":"left","yanchor":"bottom","legendTitle":true}],"hovermode":"closest","barmode":"relative"},"config":{"doubleClick":"reset","showSendToCloud":false},"source":"A","attrs":{"47147f725d2a":{"x":{},"y":{},"colour":{},"type":"scatter"},"471449fc746c":{"x":{},"y":{}},"47145d231407":{"x":{},"y":{},"ymin":{},"ymax":{},"fill":{}}},"cur_data":"47147f725d2a","visdat":{"47147f725d2a":["function (y) ","x"],"471449fc746c":["function (y) ","x"],"47145d231407":["function (y) ","x"]},"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.2,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>

</div>
</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="数据操作.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="markdown.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["CBook.pdf"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
