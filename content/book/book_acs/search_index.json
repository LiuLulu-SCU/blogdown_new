[["index.html", "ACS课题 简介", " ACS课题 刘卢路 2021年9月6日 简介 对ACS课题进行全纪录 "],["人群纳排代码.html", "1 人群纳排代码 1.1 ACS识别", " 1 人群纳排代码 1.1 ACS识别 思路 通过ICD-10编码（I20.0、I21、I22）辅以 中文字段 ，识别有ACS住院主要诊断的记录； 排除”陈旧性心肌梗死”、“未造成心肌梗死”和“急性心肌梗死后的其他近期并发症”的记录。 1.1.1 住院库中有ACS主要诊断 use &quot;文件路径&quot;,clear gen ACS=0 replace ACS=1 if strmatch(cyzd,&quot;*I20.0*&quot;) //不稳定型心绞痛 replace ACS=1 if strmatch(cyzd,&quot;*I21*&quot;) //急性心肌梗死 replace ACS=1 if strmatch(cyzd,&quot;*I22*&quot;) //继发性心肌梗死 replace ACS=1 if strmatch(cyzdmc,&quot;*冠综*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*冠脉综合*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*冠状动脉综合*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*心肌梗死*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*心肌梗塞*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*心梗*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*不稳定心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*不稳定性心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*不稳定型心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*初发劳力心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*初发劳力性心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*初发劳力型心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*恶化劳力*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*恶化性劳力*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*恶化型劳力*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*初发劳累心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*初发劳累性心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*初发劳累型心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*恶化劳累*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*恶化性劳累*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*恶化型劳累*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*自发心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*自发性心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*自发型心绞痛*&quot;) destring grbm,replace 1.1.2 排除陈旧性心肌梗死 replace ACS=0 if strmatch(cyzd,&quot;*I25.2*&quot;) //陈旧性心肌梗死 replace ACS=0 if strmatch(cyzdmc,&quot;*陈旧*&quot;) replace ACS=0 if strmatch(cyzdmc,&quot;*急性心肌梗死后的其他近期并发症*&quot;) replace ACS=0 if strmatch(cyzdmc,&quot;*急性心肌梗死后的近期并发症*&quot;) replace ACS=0 if strmatch(cyzdmc,&quot;*急性心肌梗死后的某些近期并发症*&quot;) 1.1.3 排除未造成心肌梗死 replace ACS=0 if strmatch(cyzdmc,&quot;*未造成心肌梗死*&quot;) replace ACS=0 if strmatch(cyzdmc,&quot;*可疑心肌梗死的观察*&quot;) use &quot;G:\\cz\\fyxx\\2012\\2012_zyfyxx.dta&quot;,clear gen ACS=0 replace ACS=1 if strmatch(cyzd,&quot;*I20.0*&quot;) //不稳定型心绞痛 replace ACS=1 if strmatch(cyzd,&quot;*I21*&quot;) //急性心肌梗死 replace ACS=1 if strmatch(cyzd,&quot;*I22*&quot;) //继发性心肌梗死 replace ACS=1 if strmatch(cyzdmc,&quot;*冠综*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*冠脉综合*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*冠状动脉综合*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*心肌梗死*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*心肌梗塞*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*心梗*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*不稳定心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*不稳定性心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*不稳定型心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*初发劳力心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*初发劳力性心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*初发劳力型心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*恶化劳力*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*恶化性劳力*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*恶化型劳力*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*初发劳累心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*初发劳累性心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*初发劳累型心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*恶化劳累*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*恶化性劳累*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*恶化型劳累*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*自发心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*自发性心绞痛*&quot;) replace ACS=1 if strmatch(cyzdmc,&quot;*自发型心绞痛*&quot;) replace ACS=0 if strmatch(cyzd,&quot;*I25.2*&quot;) //陈旧性心肌梗死 replace ACS=0 if strmatch(cyzdmc,&quot;*陈旧*&quot;) replace ACS=0 if strmatch(cyzdmc,&quot;*未造成心肌梗死*&quot;) replace ACS=0 if strmatch(cyzdmc,&quot;*急性心肌梗死后的其他近期并发症*&quot;) replace ACS=0 if strmatch(cyzdmc,&quot;*急性心肌梗死后的近期并发症*&quot;) replace ACS=0 if strmatch(cyzdmc,&quot;*急性心肌梗死后的某些近期并发症*&quot;) replace ACS=0 if strmatch(cyzdmc,&quot;*可疑心肌梗死的观察*&quot;) keep if ACS==1 codebook grbm //unique values: 2204 missing .: 0/2410 save &quot;G:\\ACS\\explore\\ACS_diagnose\\2012_limit_primary_ACS_sample.dta&quot;,replace use &quot;G:\\cz\\fyxx\\2012\\2012_zyfyxx.dta&quot;,clear destring grbm, replace gen ACS=0 keep if strmatch(cyzd,&quot;I20&quot;)|strmatch(cyzdmc,&quot;心绞痛&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*不稳定心绞痛*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*不稳定性心绞痛*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*不稳定型心绞痛*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*初发劳力心绞痛*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*初发劳力性心绞痛*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*初发劳力型心绞痛*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*恶化劳力*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*恶化性劳力*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*恶化型劳力*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*初发劳累心绞痛*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*初发劳累性心绞痛*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*初发劳累型心绞痛*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*恶化劳累*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*恶化性劳累*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*恶化型劳累*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*自发心绞痛*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*自发性心绞痛*&quot;) replace ACS=1 if strmatch(cyzdms,&quot;*自发型心绞痛*&quot;) keep if ACS==1 append using &quot;G:\\ACS\\explore\\ACS_diagnose\\2012_limit_primary_ACS_sample.dta&quot; codebook grbm //unique values: 2298 missing .: 0/2516 save &quot;G:\\ACS\\explore\\ACS_diagnose\\2012_limit_primary_ACS_sample.dta&quot;,replace "],["section.html", "2 ", " 2 "],["第二章.html", "3 第二章", " 3 第二章 "],["基于stata使用rmarkdown书写动态文档statamarkdown.html", "4 基于Stata使用RMarkdown书写动态文档（Statamarkdown） 4.1 下载Statamarkdown并连接Stata 4.2 链接各个代码块", " 4 基于Stata使用RMarkdown书写动态文档（Statamarkdown） 4.1 下载Statamarkdown并连接Stata 4.1.1 下载Statamarkdown library(devtools) # 如果没有devtools包，需要提前安装 install_github(&quot;hemken/Statamarkdown&quot;) 4.1.2 加载Statamarkdown library(Statamarkdown) stataexe &lt;- &quot;E:/STATA13/安装程序/StataMP-64.exe&quot; knitr::opts_chunk$set(engine.path=list(stata=stataexe)) 4.1.3 例子 sysuse auto summarize Variable | Obs Mean Std. Dev. Min Max -------------+-------------------------------------------------------- make | 0 price | 74 6165.257 2949.496 3291 15906 mpg | 74 21.2973 5.785503 12 41 rep78 | 69 3.405797 .9899323 1 5 headroom | 74 2.993243 .8459948 1.5 5 -------------+-------------------------------------------------------- trunk | 74 13.75676 4.277404 5 23 weight | 74 3019.459 777.1936 1760 4840 length | 74 187.9324 22.26634 142 233 turn | 74 39.64865 4.399354 31 51 displacement | 74 197.2973 91.83722 79 425 -------------+-------------------------------------------------------- gear_ratio | 74 3.014865 .4562871 2.19 3.89 foreign | 74 .2972973 .4601885 0 1 4.2 链接各个代码块 注意，每个STATA代码块都是作为一个独立的STATA会话来执行，彼此相互独立。即，第一个代码块调用的数据和生成的新变量，第二个代码块并不会自动继承，而需要重新调用和生成。 4.2.1 collectcode代码块选项 当Statamarkdown包加载之后，Stata代码块就可以利用collectcode选项作为块钩（chunk hook），把各代码块连接起来。这样前面块调用的数据和生成的新变量，后面的代码直接继承。Markdown代码如下。 ```stata sysuse auto generate gpm = 1/mpg summarize price gpm ``` ```stata regress price gpm ``` "],["useful.html", "5 有用的统计数字 5.1 参保人数 5.2 医保药店", " 5 有用的统计数字 5.1 参保人数 天津市城镇职工基本医疗保险数据库覆盖了天津市所有用人单位的职工及退休人员，截至2020年，天津市城职库参保人数为674.9万人，约占天津市2020年末总人口数（1386.6万人）的50.3% 。 5.2 医保药店 利用2017城职门诊库，医保数据库中有688家药店，天津有2203家药店，医保药店的比例为31.23%。 use &quot;I:\\cz\\fyxx\\2017\\2017_mzfyxx_1.dta&quot;,clear keep if yylb==&quot;00&quot; bysort yymc:keep if _n==1 set more off forvalues i=2/16{ append using &quot;I:\\cz\\fyxx\\2017\\2017_mzfyxx_`i&#39;.dta&quot;, force keep if yylb==&quot;00&quot; bysort yymc:keep if _n==1 } codebook yymc "],["数据库常用操作.html", "6 数据库常用操作 6.1 计算两个日期之间的间隔天数", " 6 数据库常用操作 6.1 计算两个日期之间的间隔天数 比如计算入院时间（rysj）和出院时间（cysj）之间的间隔天数： gen gap=cysj-rysj+1 "],["stat常用命令.html", "7 Stat常用命令 7.1 变量排序 7.2 字符型和数值型变量转化 7.3 变量重命名(rename) 7.4 筛选列(keep) 7.5 排序行 7.6 筛选出满足AB两个条件中任意一个条件的数据 7.7 取唯一行/删除重复行 7.8 查看每个变量取值出现次数或频率 7.9 计算行数 7.10 计算符合条件的行数 7.11 替代变量中的取值 7.12 合并数据 7.13 按行合并(append) 7.14 forvalue循环 7.15 保存文件(save) 7.16 时间转换", " 7 Stat常用命令 7.1 变量排序 7.1.1 order order yyts js //数据中，yyts js变量分别排在一二位 7.1.2 move move grbm sxh //把grbm变量移在sxh之前 7.2 字符型和数值型变量转化 字符型变数值型（destring） destring grbm, replace 7.3 变量重命名(rename) 7.3.1 重命名变量 rename YKA009 dlbm rename AKE001 sfxmbm 7.3.2 给变量加标签 label variable dlbm &quot;dlbm&quot; label variable sfxmbm &quot;sfxmbm&quot; 7.4 筛选列(keep) keep dlbm sfxmbm xmmc 7.5 排序行 7.5.1 升序排列(sort) sort dlbm sfxmbm 7.5.2 降序排列(gsort) gsort -ticagrelor -clopidogrel -ASA 7.6 筛选出满足AB两个条件中任意一个条件的数据 符合两个条件（clopidogrel或ticagrelor变量任意取值为1）其中一种的p2y变量值汇总起来 gen p2y=(clopidogrel==1) //(clopidogrel==1)会返回TRUE(1)和FALSE(0)的一列向量 // 如果clopidogrel==1，p2y取值为1，否则为0 replace p2y=1 if ticagrelor==1 7.7 取唯一行/删除重复行 bysort xmmc:keep if _n==1 7.8 查看每个变量取值出现次数或频率 7.8.1 查看每个变量取值的百分比(tab) tab xmmc 7.8.2 查看每个变量取值的次数 取值出现几次，就生成新的一列，值为变量取值出现的次数 bysort grbm:gen num_sw= _N //grbm出现几次，就生成新的一列，值为每个grbm出现的次数 gsort -num_sw -grbm 7.9 计算行数 7.10 计算符合条件的行数 count if MI==1 7.11 替代变量中的取值 replace ACS=1 if _merge==3 7.12 合并数据 7.13 按行合并(append) 法一 use &quot;G:\\ACS\\explore\\ACS_diagnose\\2012_ACS_sample.dta&quot;,clear append using &quot;G:\\ACS\\explore\\ACS_diagnose\\2013_ACS_sample.dta&quot;,force append using &quot;G:\\ACS\\explore\\ACS_diagnose\\2014_ACS_sample.dta&quot;,force 法二 use &quot;G:\\cz\\fyxx\\2015\\2015_zyfyxx_1.dta&quot; set more off forvalues i=2/3{ append using &quot;G:\\cz\\fyxx\\2015\\2015_zyfyxx_`i&#39;.dta&quot; } 7.14 forvalue循环 append using &quot;G:\\cz\\fymx\\2018\\2018_zyfymx_1.dta&quot; keep if cydybz==&quot;1&quot; set more off forvalues i=2/10{ append using &quot;G:\\cz\\fymx\\2018\\2018_zyfymx_`i&#39;.dta&quot; keep if cydybz==&quot;1&quot; } 7.15 保存文件(save) save &quot;G:\\ACS\\explore\\ACS_diagnose\\2015_ACS_sample.dta&quot;,replace 7.16 时间转换 7.16.1 将数值型20180904转换为04sep2018 use &quot;G:\\cz\\swsj\\sw_2018_2020.dta&quot;,clear gen sj=string(A_COL2, &quot;%12.0f&quot;) gen swsj=date(sj,&quot;YMD&quot;) format swsj %d "],["references.html", "References", " References "]]
